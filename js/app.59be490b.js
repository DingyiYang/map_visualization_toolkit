(function(t){function e(e){for(var n,o,i=e[0],s=e[1],c=e[2],u=0,_=[];u<i.length;u++)o=i[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&_.push(a[o][0]),a[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);p&&p(e);while(_.length)_.shift()();return l.push.apply(l,c||[]),r()}function r(){for(var t,e=0;e<l.length;e++){for(var r=l[e],n=!0,i=1;i<r.length;i++){var s=r[i];0!==a[s]&&(n=!1)}n&&(l.splice(e--,1),t=o(o.s=r[0]))}return t}var n={},a={app:0},l=[];function o(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=n,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var p=s;l.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";var n=r("85ec"),a=r.n(n);a.a},"0bb3":function(t,e,r){"use strict";var n=r("99d9"),a=r.n(n);a.a},"3dfd":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},["Computer"===t.currentView?r("Computer"):t._e(),"Phone"===t.currentView?r("Phone"):t._e()],1)},a=[],l=r("5698"),o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app-computer"}},[r("div",{attrs:{id:"left"}},[r("div",{staticClass:"generateMap selectBox"},[t._m(0),r("div",{staticClass:"existData"},[r("span",[t._v("Select base map")]),r("br"),r("select",{staticClass:"map_selector",attrs:{name:"test"},on:{change:function(e){return t.changeBasicMap(e)}}},[r("option",{attrs:{value:"world"}},[t._v("world")]),r("option",{attrs:{value:"china"}},[t._v("china")])]),r("br"),r("span",[t._v("Select dataset")]),r("br"),r("select",{staticClass:"data_selector",attrs:{name:"test"},on:{change:function(e){return t.changeDataSet(e)}}},[r("option",{attrs:{value:"nCoV"}},[t._v("nCoV")]),r("option",{attrs:{value:"GDP"}},[t._v("GDP")])])])]),r("div",{staticClass:"changeStyle selectBox"},[t._m(1),r("div",{staticClass:"styleTypes"},[r("span",[t._v("Line")]),r("br"),r("select",{attrs:{name:"test"},on:{change:function(e){return t.changeLineColor(e)}}},[r("option",{attrs:{value:"white"}},[t._v("White")]),r("option",{attrs:{value:"rgb(110,110,110)"}},[t._v("Gray")])]),r("br"),r("span",[t._v("Circle")]),r("br"),r("select",{attrs:{name:"test"},on:{change:function(e){return t.changeCircleColor(e)}}},[r("option",{attrs:{value:"rgb(247,254,174)"}},[t._v("Yellow")]),r("option",{attrs:{value:"white"}},[t._v("White")])]),r("br"),r("span",[t._v("Color Scale")]),r("br"),r("select",{attrs:{name:"test"},on:{change:function(e){return t.changeColorRange(t.event)}}},[r("option",{attrs:{value:"0"}},[t._v("Red Group")])])])]),r("div",{staticClass:"uploadData selectBox"},[t._m(2),t._m(3),r("div",{staticClass:"uploadPanel my_upload"},[t._v(" 上传CSV文件 "),r("input",{attrs:{type:"file",id:"file_csv",accept:".csv"},on:{change:function(e){return t.uploadCSV()}}}),r("div",{attrs:{id:"result"}})]),r("div",{staticClass:"uploadPanel2 my_upload"},[t._v(" 上传path文件 "),r("input",{attrs:{type:"file",id:"file_csv",accept:".csv"},on:{change:function(e){return t.uploadfile()}}}),r("div",{attrs:{id:"result"}})]),r("div",{staticClass:"uploadPanel3 my_upload"},[t._v(" 上传web参数文件 "),r("input",{attrs:{type:"file",id:"para_json",accept:".json"},on:{change:function(e){return t.uploadParameter()}}}),r("div",{attrs:{id:"result"}})]),r("div",{attrs:{id:"confirm_update_text"}},[r("span",{on:{click:function(e){return t.updateAllData()}}},[t._v("Generate Map")])])])]),r("div",{attrs:{id:"middle"}},[r("div",{attrs:{id:"middle-left"}},[r("div",{attrs:{id:"top-text"}},[t._v("COVID-19: Global Condition")]),r("mapPanel"),r("div",{attrs:{id:"logo"}},[r("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.logoURL,alt:"image"}})])],1)]),r("div",{attrs:{id:"bottom"}})])},i=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"selectTitle"},[r("span",[t._v("Generate map")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"selectTitle"},[r("span",[t._v("Style")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"selectTitle"},[r("span",[t._v("Upload Data")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"uploadExplaination"},[r("div",{staticClass:"detailsText"},[r("span",[t._v("You can create new maps by uploading your own data.")]),r("br"),r("span",[t._v("For details and structures of the data, please check the descriptions.")]),r("br")])])}],s=(r("ac1f"),r("1276"),r("5530")),c=r("1157"),p=r.n(c),u=r("2f62"),_=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},d=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"world_map"}},[r("div",{attrs:{id:"header"}},[r("button",{staticClass:"mybutton",attrs:{id:"chiButton"}},[t._v("中")]),r("button",{staticClass:"mybutton",attrs:{id:"engButton"}},[t._v("EN")])]),r("div",{attrs:{id:"map_floor"}}),r("div",{attrs:{id:"mapPanel"}},[r("div",{staticStyle:{display:"none"},attrs:{id:"checkboxPanel"}},[r("input",{staticClass:"my_checkbox",attrs:{id:"choose_detail",type:"checkbox",name:"item",value:"显示数字",checked:""}}),r("label",{attrs:{for:"choose_detail"}}),r("span",{staticClass:"checkbox_text",attrs:{id:"choose_detail_text"}},[t._v("显示数字")]),r("input",{staticClass:"my_checkbox",attrs:{id:"choose_country_name",type:"checkbox",name:"item",value:"显示国家名称",checked:""}}),r("label",{attrs:{for:"choose_country_name"}}),r("span",{staticClass:"checkbox_text",attrs:{id:"choose_country_name_text"}},[t._v("显示国家名称")]),r("input",{staticClass:"my_checkbox",attrs:{id:"choose_line",type:"checkbox",name:"item",value:"显示连线",checked:""}}),r("label",{attrs:{for:"choose_line"}}),r("span",{staticClass:"checkbox_text",attrs:{id:"choose_line_text"}},[t._v("显示连线")])]),r("form",{staticStyle:{display:"none"},attrs:{action:"",method:"get",id:"select_region_level"}},[r("span",{attrs:{id:"select_region_level_title"}},[t._v("地图粒度")]),r("br")]),r("div",{staticStyle:{display:"none"},attrs:{id:"PropertyPanel"}}),r("div",{staticStyle:{display:"none"},attrs:{id:"TablePanel"}},[r("span",{attrs:{id:"table_name"}},[t._v("累计数据")]),r("div",{attrs:{id:"TablePanelCursor"}}),r("div",{attrs:{id:"table_div"}})]),r("div",{staticStyle:{display:"none"},attrs:{id:"OptionPanel"}},[r("div",{attrs:{id:"OptionPanelCursor"}}),r("div",{attrs:{id:"OptionPanelText"}}),r("div",{attrs:{id:"choose_map_div"}},[r("input",{staticClass:"my_checkbox",attrs:{id:"choose_map",type:"checkbox",name:"item",value:"填色地图",checked:""}}),r("label",{attrs:{for:"choose_map"}}),r("span",{staticClass:"checkbox_text",attrs:{id:"choose_map_text"}},[t._v("填色地图")])]),r("div",{attrs:{id:"choose_circle_div"}},[r("input",{staticClass:"my_checkbox",attrs:{id:"choose_circle",type:"checkbox",name:"item",value:"数量圆圈",checked:""}}),r("label",{attrs:{for:"choose_circle"}}),r("span",{staticClass:"checkbox_text",attrs:{id:"choose_circle_text"}},[t._v("圆圈")])])]),r("div",{staticStyle:{display:"none"},attrs:{id:"LineChartPanel"}},[r("span",{attrs:{id:"line_chart_name"}},[t._v("折线图")]),r("div",{attrs:{id:"LineChartCursor"}}),r("div",{staticStyle:{display:"none"},attrs:{id:"line_chart_div"}})])])])}],f=(r("99af"),r("caad"),r("c975"),r("a15b"),r("d81d"),r("b0c0"),r("a9e3"),r("b680"),r("d3b7"),r("4d63"),r("25f0"),r("2532"),r("5319"),navigator.userAgent.toLowerCase()),h='Roboto, SourceHanSansCN, "思源黑体", Noto Sans SC, Khand-Regular';/\(i[^;]+;( U;)? CPU.+Mac OS X/gi.test(f)&&(h="PingFangSC-Regular"),l["select"]("#world_map").style("font-family",h);var y={name:"WorldMap",data:function(){return{pixel_PMP:null,watch:!0,proj:null,map_lon_range:{china:60,world:288},map_lat_range:{china:30,world:144}}},computed:Object(s["a"])({},Object(u["c"])(["selectedMap","selectedDataSet","mapData","statistic","pathData","webParameter","confirmUpdate"])),watch:{selectedMap:function(t){var e=this;e.changeView()},selectedDataSet:function(t){var e=this;e.changeView()},confirmUpdate:function(t){var e=this;console.log("confirmUpdate"),l["select"]("#top-text").text(""),this.width=p()("#mapPanel").width(),this.height=p()("#mapPanel").height(),l["select"]("#mapPanel").select(".mySvg").remove(),0!=t&&(e.updateSelectDataset(""),null!=e.statistic&&null!=e.webParameter&&("world"==e.selectedMap?l["json"]("population.json").then((function(t){l["json"]("square.json").then((function(r){e.country_population=t,e.country_square=r,l["json"]("world_map/world_new.geo.json").then((function(t){l["json"]("world_map/all_province_map.json").then((function(r){var n=e.statistic,a=e.webParameter,l={};e.WorldMap(t,r,n,l,a)}))}))}))})):l["json"]("china_population.json").then((function(t){l["json"]("china_square.json").then((function(r){e.country_population=t,e.country_square=r,l["json"]("map/china.geo.json").then((function(t){l["json"]("map/china_all_province_map.json").then((function(r){var n=e.statistic,a=e.webParameter,l=e.path_data;e.WorldMap(t,r,n,l,a)}))}))}))}))),e.updateConfirmUpdate(!1))}},mounted:function(){this.init()},methods:Object(s["a"])({},Object(u["b"])(["updateConfirmUpdate","updateSelectDataset","updateSelectMap"]),{changeView:function(){l["select"]("#top-text").text(""),this.width=p()("#mapPanel").width(),this.height=p()("#mapPanel").height(),l["select"]("#mapPanel").select(".mySvg").remove();var t=this;t.temp_selected_country_chinese="",t.temp_selected_country="","nCoV"==t.selectedDataSet?"world"==t.selectedMap?l["json"]("population.json").then((function(e){l["json"]("square.json").then((function(r){var n,a,o;t.country_square=r,t.country_population=e,l["json"]("world_map/world_new.geo.json").then((function(e){a=e,l["json"]("world_map/all_province_map.json").then((function(e){l["csv"]("https://vis.ucloud365.com/ncov/data/map.csv").then((function(r){n=r,l["csv"]("https://vis.ucloud365.com/ncov/data/foreign.csv").then((function(r){o=r;for(var i=0;i<o.length;i++){var s=0;""!=o[i]["新增确诊病例"]&&(s=parseInt(o[i]["新增确诊病例"])),""!=o[i]["核减确诊病例"]&&(s+=parseInt(o[i]["核减确诊病例"])),o[i]["新增确诊病例"]=s}for(i=0;i<n.length;i++)if("地区级"!=n[i]["类别"]&&("省级"!=n[i]["类别"]||-1!=["台湾","香港","澳门"].indexOf(n[i]["省份"]))){var c=0,p={"国家":"中国"};p["当地时间"]=n[i]["公开时间"],p["新增死亡数"]=n[i]["新增死亡数"],p["新增治愈出院数"]=n[i]["新增治愈出院数"],""!=n[i]["新增确诊病例"]&&(c=parseInt(n[i]["新增确诊病例"])),""!=n[i]["核减"]&&(c+=parseInt(n[i]["核减"])),p["新增确诊病例"]=c,o.push(p)}l["csv"]("https://vis.ucloud365.com/ncov/data/foreigndetail.csv").then((function(r){l["json"]("parameter.json").then((function(n){t.WorldMap(a,e,o,r,n)}))}))}))}))}))}))}))})):"china"==t.selectedMap&&l["json"]("china_population.json").then((function(e){l["json"]("china_square.json").then((function(r){var n,a;t.country_square=r,t.country_population=e;var o=[];a=t.mapData,l["json"]("map/china_all_province_map.json").then((function(e){l["csv"]("https://vis.ucloud365.com/ncov/data/map.csv").then((function(r){n=r;for(var i=0;i<n.length;i++){if("省级"==n[i]["类别"]){if(-1==["台湾","香港","澳门"].indexOf(n[i]["省份"]))continue}else if("地区级"!=n[i]["类别"])continue;var s=0;""!=n[i]["新增确诊病例"]&&(s=parseInt(n[i]["新增确诊病例"])),""!=n[i]["核减"]&&(s+=parseInt(n[i]["核减"])),n[i]["新增确诊病例"]=s;var c=0;""!=n[i]["新增治愈出院数"]&&(c=parseInt(n[i]["新增治愈出院数"])),""!=n[i]["治愈核减"]&&(c+=parseInt(n[i]["治愈核减"])),n[i]["新增治愈出院数"]=c;var p=0;""!=n[i]["新增死亡数"]&&(p=parseInt(n[i]["新增死亡数"])),""!=n[i]["死亡核减"]&&(p+=parseInt(n[i]["死亡核减"])),n[i]["新增死亡数"]=p;var u=n[i];o.push(u)}var _={};l["json"]("china_parameter.json").then((function(r){t.WorldMap(a,e,o,_,r)}))}))}))}))})):"world"==t.selectedMap?l["json"]("population.json").then((function(e){l["json"]("square.json").then((function(r){t.country_population=e,t.country_square=r,l["json"]("world_map/world_new.geo.json").then((function(e){l["json"]("world_map/all_province_map.json").then((function(r){l["csv"]("map_data/world_"+t.selectedDataSet+".csv").then((function(n){console.log(t.selectedDataSet),l["json"]("parameter/world_"+t.selectedDataSet+"_parameter.json").then((function(a){var l={};t.WorldMap(e,r,n,l,a)}))}))}))}))}))})):l["json"]("china_population.json").then((function(e){l["json"]("china_square.json").then((function(r){t.country_population=e,t.country_square=r,l["json"]("map/china.geo.json").then((function(e){l["json"]("map/china_all_province_map.json").then((function(r){l["csv"]("map_data/china_"+t.selectedDataSet+".csv").then((function(n){l["json"]("parameter/china_"+t.selectedDataSet+"_parameter.json").then((function(a){var l={};t.WorldMap(e,r,n,l,a)}))}))}))}))}))}))},WorldMap:function(t,e,r,n,a){var o=this;l["select"]("#engButton").on("click",(function(){o.$router.push({query:{language:"en"}}),fr()})),l["select"]("#chiButton").on("click",(function(){o.$router.push({query:{language:"cn"}}),dr()})),l["select"]("#choose_detail").on("click",(function(){cr()})),l["select"]("#choose_country_name").on("click",(function(){pr()})),l["select"]("#choose_circle").on("click",(function(){_r()})),l["select"]("#choose_map").on("click",(function(){ur()})),l["select"]("#TablePanelCursor").on("click",(function(){qe()})),l["select"]("#choose_line").on("click",(function(){sr("")})),l["select"]("#LineChartCursor").on("click",(function(){Je()})),l["select"]("#TablePanelCursor").on("click",(function(){qe()}));for(var i=document.getElementsByName("region_level"),s=0;s<i.length;s++)if("country"==i[s].value){i[s].checked=!0;break}var c,u,_,d,f,h,y,v,m,g,x,w,A,b,P,O,S,k,C,j,D,T,M,z,I=0,E=0,L=1,U=1,N=.9,R="date",B=0,V="",F="",G=["white","gray"],q=[{english:"Total Value",english_short:"Total",chinese:"累计值",chinese_short:"累计"},{english:"Newly Value",english_short:"Newly",chinese:"新增数值",chinese_short:"新增"},{english:"Percentage",english_short:"Percent",chinese:"百分比",chinese_short:"百分比"},{english:"Per Million Population",english_short:"PMP",chinese:"占人口比 (每百万人)",chinese_short:"占人口比"},{english:"Per Square Kilometer",english_short:"Per KM2",chinese:"密度 (每平方千米)",chinese_short:"密度"}],W={Total:{english:"Cases",chinese:"例"},PMP:{english:"Per Million",chinese:"每百万人"},Percent:{english:"%",chinese:"%"},Newly:{english:"Cases",chinese:"例"},"Per KM2":{english:"Per Square Kilometer",chinese:"每平方千米"}},$="nCoV",H="Confirmed_Total_data",K="Confirmed_Total_data",Y=1,J="Total",X="Total",Q=0,Z=0,tt=0,et=0,rt=0,nt=0,at=1e3,lt={};o.temp_selected_country="",o.temp_selected_country_chinese="";var ot,it,st,ct={Confirmed:"",Recovered:"Confirmed",Dead:"Confirmed"},pt={Confirmed:1,Recovered:1/3,Dead:1/4},ut="Confirmed_Total",_t=0,dt=0,ft={},ht={},yt={},vt={},mt=1,gt="english",xt=["斯洛文尼亚","匈牙利","罗马尼亚","圣马力诺","摩纳哥","亚美尼亚","阿塞拜疆","沙特阿拉伯","马来西亚","法国","西班牙","意大利","英国","卢森堡","伊拉克","卡塔尔","阿联酋","瑞典","挪威","德国","荷兰","丹麦","瑞士","克罗地亚","奥地利","比利时","北马其顿","立陶宛","白俄罗斯","黎巴嫩","以色列","科威特","葡萄牙","冰岛","波兰","斯洛伐克","奥地利","巴勒斯坦","以色列","巴林","阿尔巴尼亚","安道尔","爱沙尼亚","拉脱维亚","乌克兰","保加利亚","马耳他","捷克","摩尔多瓦","希腊","芬兰","塞尔维亚","波黑"],wt={AF:["厄立特里亚","佛得角","冈比亚","刚果（布）","莫桑比克","津巴布韦","喀麦隆","科特迪瓦","肯尼亚","留尼汪","阿尔及利亚","埃及","埃塞俄比亚","安哥拉","贝宁","马约特","毛里求斯","毛里塔尼亚","纳米比亚","加蓬","塞内加尔","塞舌尔","斯威士兰","坦桑尼亚","突尼斯","乌干达","赤道几内亚","多哥","几内亚","加纳","卢旺达","马达加斯加","尼日尔","赞比亚","布基纳法索","刚果（金）","利比里亚","南非","尼日利亚","乍得","中非共和国","摩洛哥","吉布提","几内亚比绍","塞拉利昂","圣多美和普林西比","圣赫勒拿","阿森松","特里斯坦-达库尼亚","加那利群岛","科摩罗","博茨瓦纳","布隆迪","苏丹","索马里","索马里兰","西撒哈拉","休达","莱索托","马德拉","梅利利亚","南苏丹","马拉维","马里","利比亚"],EUR:["阿尔巴尼亚","爱尔兰","爱沙尼亚","安道尔","奥地利","白俄罗斯","保加利亚","北马其顿","比利时","冰岛","波黑","波兰","丹麦","德国","俄罗斯","法国","梵蒂冈","芬兰","荷兰","黑山","捷克","克罗地亚","拉脱维亚","立陶宛","列支敦士登","卢森堡","罗马尼亚","马耳他","摩尔多瓦","摩纳哥","挪威","葡萄牙","瑞典","瑞士","塞尔维亚","塞浦路斯","圣马力诺","斯洛伐克","斯洛文尼亚","乌克兰","西班牙","希腊","匈牙利","意大利","英国","法罗群岛","根西岛","马恩岛"],AS:["阿富汗","阿联酋","阿曼","阿塞拜疆","巴基斯坦","巴勒斯坦","巴林","不丹","朝鲜","东帝汶","菲律宾","格鲁吉亚","哈萨克斯坦","韩国","吉尔吉斯斯坦","柬埔寨","卡塔尔","科威特","老挝","黎巴嫩","马尔代夫","马来西亚","蒙古","孟加拉国","缅甸","尼泊尔","日本","沙特阿拉伯","斯里兰卡","塔吉克斯坦","泰国","土耳其","土库曼斯坦","文莱","乌兹别克斯坦","新加坡","叙利亚","亚美尼亚","也门","伊拉克","伊朗","以色列","印度","印度尼西亚","约旦","越南"],SA:["阿根廷","巴拉圭","巴西","秘鲁","玻利维亚","厄瓜多尔","哥伦比亚","法属圭亚那","苏里南","委内瑞拉","乌拉圭","智利","福克兰群岛"],"Mid East":["也门","阿联酋","土耳其","叙利亚","沙特阿拉伯","卡塔尔","巴勒斯坦","阿曼","黎巴嫩","科威特","约旦","以色列","伊拉克","伊朗","埃及","塞浦路斯","巴林","约旦河西岸"]};o.detail_countries_name,o.show_region_level="country";var At=[],bt=this.width,Pt=p()("#world_map").width(),Ot=this.height,St=p()("#world_map").height();mt=45e-5*bt;var kt=.005*bt,Ct=.005*Ot;bt-=2*kt,Ot-=2*Ct;var jt=.23;jt=Ot>=bt||Ot>.9*bt/5*3?.9*bt*.15:Ot/3*5*.15;var Dt=mt,Tt=.017*Ot,Mt=l["scaleLinear"]().domain([0,4]).range(["rgba(240,140,131,0.8)","rgba(187,0,0,0.9)"]).interpolate(l["interpolateHcl"]),zt=l["select"]("#mapPanel").append("svg").attr("class","mySvg").attr("transform","translate("+kt+","+Ct+")").attr("width",bt).attr("height",Ot).append("g"),It=l["geoMercator"]().center([160,30]).scale(jt).translate([.55*bt,Ot/2]),Et=l["geoMercator"]().center([-200,30]).scale(jt).translate([.55*bt,Ot/2]),Lt=l["geoMercator"]().center([100,38]).scale(l["min"]([bt/1.8,1.2*Ot])).translate([bt/2,Ot/2]),Ut=Rt;function Nt(t){var e=l["geoPath"]().projection(Lt);if("china"==o.selectedMap)return e(t);var r=l["geoPath"]().projection(It),n=l["geoPath"]().projection(Et),a=t.geometry.coordinates[0][0];while(a.length>1)a=a[0];return"ATA"!=t.id?a>-30?r(t):n(t):void 0}function Rt(t){return t[0]>-30?It(t):Et(t)}"china"==o.selectedMap&&(Ut=Lt);var Bt=zt.append("g").attr("class","map_g"),Vt=l["zoom"]().on("zoom",Qt),Ft="0.11%",Gt=1,qt=1,Wt=0,$t=0,Ht=0,Kt=0,Yt=1,Jt=0,Xt=0;function Qt(){l["selectAll"](".country_table").style("background-color",(function(t){return""}));var t=Gt;Gt=Gt*l["event"].transform.k/qt,l["event"].transform.k==qt?Wt+=l["event"].transform.x-Ht:Wt+=(l["event"].transform.x-Ht)/(l["event"].transform.k/Gt),l["event"].transform.k==qt?$t+=l["event"].transform.y-Kt:$t+=(l["event"].transform.y-Kt)/(l["event"].transform.k/Gt),Ht=l["event"].transform.x,Kt=l["event"].transform.y,qt=l["event"].transform.k,Gt!=t&&(o.temp_selected_country="",o.temp_selected_country_chinese="",Zt()),te(),""!=o.temp_selected_country_chinese&&$e()}function Zt(){Ke(),zt.selectAll(".unkown_info").remove(),l["selectAll"](".overview_info").style("display",""),l["selectAll"](".selected_country_info").style("display","none"),l["selectAll"](".region").selectAll("path").attr("display",(function(t){return""})).style("display",(function(t){return ye(t)})),l["selectAll"](".country_text").style("display","").attr("display",(function(t){return""})),l["selectAll"](".country_text2").style("display","").attr("display",(function(t){return""})),l["selectAll"](".country_num_text").style("display","").attr("display",(function(t){return""})),l["selectAll"](".country_num_text_shadow").style("display","").attr("display",(function(t){return""})),l["selectAll"](".num_circle").attr("display",(function(t){return he(t)})),be()}function te(t){l["selectAll"](".highlight_region").selectAll("path").attr("display",(function(t){return"none"})),Se(),Bt.transition().duration(t).attr("transform",(function(){return"translate("+Wt+","+$t+") scale("+Gt+","+Gt+")"})),sr(!0),Gt>2?(o.country_text_size=15*mt/Gt,l["selectAll"](".country_text").transition().duration(t).attr("font-size",o.country_text_size).attr("display",(function(t){return fe(t)})),l["selectAll"](".country_text2").transition().duration(t).attr("font-size",o.country_text_size).attr("display",(function(t){return fe(t)})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[1]+o.country_text_size}})),l["selectAll"](".country_num_text").transition().duration(t).attr("font-size",o.country_text_size).attr("display",(function(t){return fe(t)})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return t.properties.name.split(" ").length<2||"chinese"==gt?e[1]+o.country_text_size:e[1]+2*o.country_text_size}})),l["selectAll"](".country_num_text_shadow").transition().duration(t).attr("font-size",o.country_text_size).attr("display",(function(t){return fe(t)})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return t.properties.name.split(" ").length<2||"chinese"==gt?e[1]+o.country_text_size:e[1]+2*o.country_text_size}})),l["selectAll"](".mycircle").attr("r",(function(t){return t.main_data<=it?5*mt:0})),1==U&&1==L&&l["selectAll"](".links").style("stroke-width",(function(t){return t.main_data<=it?"0.05%":0})),Ft="0.05%"):Gt<=2&&(mt=Dt,o.country_text_size=12*mt,l["selectAll"](".country_text").transition().duration(t).attr("font-size",(function(t){return-1!=xt.indexOf(t.properties.chinese_name)?.6*o.country_text_size:o.country_text_size})).attr("display",(function(t){return fe(t)})),l["selectAll"](".country_text2").transition().duration(t).attr("font-size",(function(t){return-1!=xt.indexOf(t.properties.chinese_name)?.6*o.country_text_size:o.country_text_size})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[1]+o.country_text_size}})).attr("display",(function(t){return fe(t)})),l["selectAll"](".country_num_text_shadow").transition().duration(t).attr("font-size",(function(t){return-1!=xt.indexOf(t.properties.chinese_name)?.6*o.country_text_size:o.country_text_size})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return t.properties.name.split(" ").length<2||"chinese"==gt?e[1]+o.country_text_size:e[1]+2*o.country_text_size}})).attr("display",(function(t){return fe(t)})),l["selectAll"](".country_num_text").transition().duration(t).attr("font-size",(function(t){return-1!=xt.indexOf(t.properties.chinese_name)?.6*o.country_text_size:o.country_text_size})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return t.properties.name.split(" ").length<2||"chinese"==gt?e[1]+o.country_text_size:e[1]+2*o.country_text_size}})).attr("display",(function(t){return fe(t)})),1==U&&1==L&&l["selectAll"](".links").style("stroke-width",(function(t){return t.main_data<=it?"0.11%":0})),Ft="0.11%"),_r(),cr(),pr(),rr(ne,it)}window.onresize=function(){if(!(o.height>=o.width)){var t=l["select"]("#mapPanel").select(".mySvg"),e=(t.select(".map_g"),p()("#mapPanel").width()),r=p()("#mapPanel").height();t.attr("height",(function(){return r})).attr("width",(function(){return e})),Yt=r/o.height,Jt=o.width/2*(1-r/o.height),Xt=(o.height,(r-o.height)/2),Gt=r/o.height*.9,Wt=o.width/2*(e/o.width-Gt),$t=o.height/2*(r/o.height-Gt),te(),ke(),Se(),se=.65*Ot+Xt,ve(),Me(),1==Be?Ne(ot):(Ve(),Ne(ot),Ve());var n=1.1*l["max"]([.035*bt,.05*Ot]),a=n,i=.06*Ot;l["select"]("#TablePanel").style("top",(function(){return""==u?.2*Ot/p()("#mapPanel").height()*100+"%":.25*Ot/p()("#mapPanel").height()*100+"%"})),l["select"]("#select_region_level").style("top",(i+1.1*a)/r*100+"%"),l["selectAll"](".southsea_img").attr("y",(function(t){return.8*p()("#mapPanel").height()})),o.temp_selected_country="",o.temp_selected_country_chinese="",Zt(),l["selectAll"](".country_table").style("background-color",(function(t){return""})),l["selectAll"](".zoom_icon").attr("xlink:href",(function(t,e){return"Global"==t.id?"icon/"+t.loc_name+"-点.svg":"icon/"+t.loc_name+"-未点.svg"}))}},zt.call(Vt).on("dblclick.zoom",null);var ee,re,ne=1900,ae=2019,le=1,oe=.17*bt,ie=.012*bt,se=.8*Ot,ce=l["scaleLinear"]().domain([ne,ae]).range([0,oe]);function pe(t,e,r,n,a){H="Confirmed_Total_data",String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"gm"),e)},o.worldDataAll={},ue(a);var i=[];ct={};for(var s=0;s<h.length;s++)i.push(h[s].english_name),ct[h[s].english_name]=h[s].father_pro;for(var p,y,v={},m=0;m<i.length;m++)for(var g=0;g<q.length;g++){var x=i[m]+"_"+q[g].english_short+"_data";v[x]={}}ut=h[0].english_name+"_Total",K=h[0].english_name+"_Total_data",H=h[0].english_name+"_Total_data",o.temp_selected_country="",o.temp_selected_country_chinese="";p="99999999",y="00000000";for(o.detail_countries_name=[],s=0;s<r.length;s++){var b=r[s][f],P="";1==Object.prototype.hasOwnProperty.call(r[s],c)&&(P=r[s][c]);var O="";""!=u&&(1==Object.prototype.hasOwnProperty.call(r[s],u)&&(O=r[s][u]),O=gr(O));var S=wr(b);if(parseInt(S)>parseInt(y)&&(y=S),parseInt(S)<parseInt(p)&&(p=S),void 0!=P){if(-1!=P.indexOf("圣马丁")&&(P="圣马丁岛"),""!=P){if(0==Object.prototype.hasOwnProperty.call(o.worldDataAll,P))for(o.worldDataAll[P]={},m=0;m<i.length;m++)for(g=0;g<q.length;g++){var k=i[m]+"_"+q[g].english_short+"_data";o.worldDataAll[P][k]={}}if(""!=O&&0==Object.prototype.hasOwnProperty.call(o.worldDataAll[P],O))for(o.worldDataAll[P][O]={},m=0;m<i.length;m++)for(g=0;g<q.length;g++){var C=i[m]+"_"+q[g].english_short+"_data";o.worldDataAll[P][O][C]={}}for(m=0;m<h.length;m++){var j=h[m],D=0;if(""!=r[s][j.input_pro]){D=parseFloat(r[s][j.input_pro]);var T=j.english_name+"_Total_data";"Newly"==j.data_type&&(T=j.english_name+"_Newly_data"),1==j.is_time_varying?(1!=j.is_number&&""!=O||(0==Object.prototype.hasOwnProperty.call(o.worldDataAll[P][T],S)?o.worldDataAll[P][T][S]=D:1==j.is_number&&(o.worldDataAll[P][T][S]+=D)),""!=O&&(-1==o.detail_countries_name.indexOf(P)&&"香港"!=P&&"澳门"!=P&&"台湾"!=P&&o.detail_countries_name.push(P),0==Object.prototype.hasOwnProperty.call(o.worldDataAll[P][O][T],S)?o.worldDataAll[P][O][T][S]=D:1==j.is_number&&(o.worldDataAll[P][O][T][S]+=D))):(1!=j.is_number&&""!=O||(o.worldDataAll[P][T]=D),""!=O&&(o.worldDataAll[P][O][T]=D))}}}}else console.log(r[s])}console.log(p+" "+y),2!=A.length&&(A=[p,y]),ne=A[0],ae=A[1],it=ae.toString();var M=ne,z=ae;1!=_t&&0!=le&&"date"!=R||(p=A[0],M=0,z=Sr(A[0],A[1])),ce=l["scaleLinear"]().domain([M,z]).range([0,oe]),t["overview"]={};for(var I=parseInt(p);I<=parseInt(y);){for(t["overview"][I]={country_num:0},m=0;m<i.length;m++)t["overview"][I][i[m]+"_Total_data"]=0;I=Ar(I,1).replaceAll("/","")}for(s=0;s<t.features.length;s++){t.features[s].properties.chinese_name;for(isNaN(t.features[s].properties.dx)&&(t.features[s].properties.dx=0),isNaN(t.features[s].properties.dy)&&(t.features[s].properties.dy=0),t.features[s].properties.hasData=0,t.features[s].properties.stage="null",m=0;m<i.length;m++)for(g=0;g<q.length;g++){var E=i[m]+"_"+q[g].english_short+"_data";t.features[s].properties[E]={}}t.features[s].properties.region_level=0}var L={};for(m=0;m<i.length;m++)for(g=0;g<q.length;g++){var U=i[m]+"_"+q[g].english_short;L[U]={}}for(var N in L)lt[N]={min:1e7,max:0};for(var B in wt)for(N in lt[B]={},L)lt[B][N]={min:1e7,max:0};for(var V in o.worldDataAll){var F=parseInt(p),G=1;for(var W in o.worldDataAll[V]){var $=o.worldDataAll[V];if(0==Object.prototype.hasOwnProperty.call(o.worldDataAll[V][W],i[0]+"_Total_data")){if(1!=G)continue;G=0}else $=o.worldDataAll[V][W];for(m=0;m<i.length;m++){var Y=$[i[m]+"_Total_data"];0==h[m].is_time_varying&&(1==h[m].is_unit_person&&($[i[m]+"_PMP_data"]=br(Y,o.country_population[V])),1==h[m].is_number&&($[i[m]+"_Per KM2_data"]=Or(Y,o.country_square[V])),""!=h[m].father_pro&&1==h[m].is_number&&($[i[m]+"_Percent_data"]=Pr(Y,$[ct[i[m]]+"_Total_data"][s])))}for(var J=parseInt(p);J<=parseInt(y);){for(m=0;m<i.length;m++)if(0!=h[m].is_time_varying)if("Newly"==h[m].data_type){var X=0;1==Object.prototype.hasOwnProperty.call($[i[m]+"_Newly_data"],J)&&(X=$[i[m]+"_Newly_data"][J]),J==parseInt(p)?$[i[m]+"_Total_data"][J]=X:$[i[m]+"_Total_data"][J]=$[i[m]+"_Total_data"][F]+X}else 0==Object.prototype.hasOwnProperty.call($[i[m]+"_Total_data"],J)&&($[i[m]+"_Total_data"][J]=$[i[m]+"_Total_data"][F]);for(m=0;m<i.length;m++)0!=h[m].is_time_varying&&0!=h[m].is_number&&("Total"==h[m].data_type?J==parseInt(p)?$[i[m]+"_Newly_data"][J]=$[i[m]+"_Total_data"][J]:$[i[m]+"_Newly_data"][J]=$[i[m]+"_Total_data"][J]-$[i[m]+"_Total_data"][F]:0==Object.prototype.hasOwnProperty.call($[i[m]+"_Newly_data"],J)&&($[i[m]+"_Newly_data"][J]=0));for(m=0;m<i.length;m++)if(0!=h[m].is_time_varying&&0!=h[m].is_unit_person){var Q=i[m]+"_PMP_data",Z=0;$==o.worldDataAll[V]?Z=o.country_population[V]:1==Object.prototype.hasOwnProperty.call(o.country_population,V+"分区")&&(Z=o.country_population[V][W]),0!=Z&&($[Q][J]=br($[i[m]+"_Total_data"][J],Z))}for(m=0;m<i.length;m++)if(0!=h[m].is_time_varying){var tt=i[m]+"_Percent_data";if(0!=h[m].is_number&&""!=ct[i[m]]){var et=ct[i[m]]+"_Total_data";$[tt][J]=Pr($[i[m]+"_Total_data"][J],$[et][J])}}for(m=0;m<i.length;m++)if(0!=h[m].is_time_varying&&0!=h[m].is_number){var rt=i[m]+"_Per KM2_data",nt=0;$==o.worldDataAll[V]?nt=o.country_square[V]:1==Object.prototype.hasOwnProperty.call(o.country_square,V+"分区")&&(nt=o.country_square[V][W]),0!=nt&&($[rt][J]=Or($[i[m]+"_Total_data"][J],o.country_square[V]))}if($.population=o.country_population[V],$==o.worldDataAll[V])for(m=0;m<i.length;m++){var at=i[m]+"_Total_data";o.worldDataAll[V][at][J]>0&&(t["overview"][J][at]+=o.worldDataAll[V][at][J]),o.worldDataAll[V][at][J]>0&&0==m&&(t["overview"][J]["country_num"]+=1)}F=J,J=Ar(J,1).replaceAll("/","")}}}console.log(o.worldDataAll);var st=[],pt={},dt={},mt={},gt={},xt={},bt={"中国":[]};for(s=0;s<t.features.length;s++){var Pt=t.features[s].properties.chinese_name;if("多米尼亚"==Pt&&(Pt="多米尼亚共和国"),pt[Pt]=t.features[s].properties.cp,dt[Pt]=t.features[s].properties.name,xt[Pt]=s,mt[Pt]=t.features[s].properties.lon_range,gt[Pt]=t.features[s].properties.lat_range,Object.prototype.hasOwnProperty.call(o.worldDataAll,Pt)){for(o.worldDataAll[Pt]["found"]=1,t.features[s].properties.hasData=1,m=0;m<i.length;m++)for(g=0;g<q.length;g++){var Ot=i[m]+"_"+q[g].english_short+"_data";t.features[s].properties[Ot]=o.worldDataAll[Pt][Ot]}var St=o.worldDataAll[Pt]["population"];t.features[s].properties["population"]=St,bt[Pt]=[]}}for(s=0;s<o.detail_countries_name.length;s++){var kt=o.detail_countries_name[s],Ct=e[kt];for(m=0;m<Ct.features.length;m++){Ct.features[m].properties.region_level=1;var jt=Ct.features[m].properties.name;if(Ct.features[m].properties.dx=0,Ct.features[m].properties.dy=0,0!=Object.prototype.hasOwnProperty.call(o.worldDataAll,kt))if(0!=Object.prototype.hasOwnProperty.call(o.worldDataAll[kt],jt)){Ct.features[m].properties.hasData=1;for(var Dt=0;Dt<i.length;Dt++)for(var Tt=0;Tt<q.length;Tt++){var Mt=i[Dt]+"_"+q[Tt].english_short+"_data";Ct.features[m].properties[Mt]=o.worldDataAll[kt][jt][Mt],0==Object.prototype.hasOwnProperty.call(lt,kt)&&(lt[kt]={}),0==Object.prototype.hasOwnProperty.call(lt[kt],Mt)&&(lt[kt][Mt]={min:1e7,max:0});for(var zt=parseInt(p);zt<=parseInt(y);zt=Ar(zt,1).replaceAll("/","")){var It=o.worldDataAll[kt][jt][Mt][zt];It<=0||(It>lt[kt][Mt].max&&(lt[kt][Mt].max=It),It<lt[kt][Mt].min&&(lt[kt][Mt].min=It))}}}else Ct.features[m].properties.hasData=0}ht[kt]=Ct}for(var Et in At=[],dt["开曼群岛"]="the Cayman Islands",dt["留尼汪"]="Réunion",dt["安提瓜和巴布达"]="Antigua and Barbuda",dt["法属波利尼西亚"]="French Polynesia",dt["马提尼克"]="Martinique",dt["圣巴托洛缪岛"]="Saint-Barthélemy",dt["泽西岛"]="Jersey",dt["圣文森特和格林纳丁斯"]="Saint Vincent and the Grenadines",dt["马提尼克岛"]="Reunion Island",dt["库拉索"]="Curaçao",dt["马约特"]="mayotte",dt["瓜德罗普岛"]="Guadeloupe",dt["巴哈马"]="Bahamas",dt["塞舌尔"]="Seychelles",dt["关岛"]="Guam",dt["阿鲁巴"]="Aruba",dt["巴巴多斯"]="Barbados",dt["美属维尔京群岛"]="Virgin Islands",o.worldDataAll){for(N in L)for(var Nt=parseInt(p);Nt<=parseInt(y);Nt=Ar(Nt,1).replaceAll("/","")){var Bt=o.worldDataAll[Et][N+"_data"][Nt];if(!(Bt<0))for(B in 0!=Bt&&Bt<lt[N].min&&(Bt<.001&&(Bt=.001),Bt=parseInt(1e3*Bt)/1e3,lt[N].min=Bt),Bt>lt[N].max&&(lt[N].max=Bt),wt)-1!=wt[B].indexOf(Et)&&(Bt>0&&Bt<lt[B][N].min&&(Bt<.001&&(Bt=.001),Bt=parseInt(1e3*Bt)/1e3,lt[B][N].min=Bt),Bt>lt[B][N].max&&(lt[B][N].max=Bt))}var Vt=o.worldDataAll[Et];Vt["chinese_name"]=Et,0==Object.prototype.hasOwnProperty.call(dt,Et)?Vt["english_name"]=Et:Vt["english_name"]=dt[Et],1==Object.prototype.hasOwnProperty.call(mt,Et)&&(Vt["lon_range"]=mt[Et]),1==Object.prototype.hasOwnProperty.call(gt,Et)&&(Vt["lat_range"]=gt[Et]),Vt["cp"]=pt[Et],"中国"!=Et&&"海南"!=Et||(re=Vt),At.push(Vt),1!=o.worldDataAll[Et]["found"]&&console.log(Et)}At=At.sort(mr(ut+"_data",y));if(n!={}){for(var Ft=0;Ft<n.length;Ft++){n[Ft][d];var Gt=n[Ft][_];wr(Gt);parseInt(n[Ft]["数目"])>0&&parseInt(n[Ft]["数目"]);var qt=n[Ft]["输入来源国家"];if(""==qt&&(qt=n[Ft]["本地感染接触人来源国家"]),""!=qt){qt.split("疑似").length>=2&&(qt=qt.split("疑似")[1]),qt.split("经").length>=2&&(qt=qt.split("经")[0].split("从")[1]);var Wt=n[Ft]["国家"];if(Wt=Wt.split(" ")[0],qt=qt.split(" ")[0],"加拿大"==Wt&&(qt="中国"),"钻石公主号邮轮"==qt&&(Wt="日本"),qt==Wt)continue;if(0==Object.prototype.hasOwnProperty.call(pt,Wt))continue;if(0==Object.prototype.hasOwnProperty.call(pt,qt))continue;var $t=0;if(0==Object.prototype.hasOwnProperty.call(bt,Wt))continue;if(-1==bt[Wt].indexOf(qt)&&($t=1,bt[Wt].push(qt)),1==$t){var Ht={},Kt=Wt,Yt=pt[Wt],Jt=pt[qt];if(Ht["source"]={name:dt[qt],id:xt[qt],x:Jt[0],y:Jt[1]},Ht["target"]={name:dt[Wt],id:xt[Wt],x:Yt[0],y:Yt[1]},0==Object.prototype.hasOwnProperty.call(o.worldDataAll,Kt))continue;var Xt=n[Ft][_],Qt=wr(Xt);Ht["date"]=Qt,Ht["main_data"]=Qt,Ht["stage"]=o.worldDataAll[Kt]["stage"],st.push(Ht)}}}1,yt=st,vt=st}ft=t;Ut=Rt,"china"==o.selectedMap&&(Ut=Lt),Zt=[];var Zt=[0],te=h[0].english_name+"_Total";for(Zt=h[0].map_data_range.length>0?h[0].map_data_range:lt[te].min>lt[te].max?[0]:Le(lt[te].max,"int"),w=[],s=0;s<Zt.length-1;s++){if(Zt[s]>lt[te].max)break;w.push({name:Zt[s]+" - "+Zt[s+1],id:s,range:[Zt[s],Zt[s+1]]})}setTimeout((function(){ot=[];for(var t=0;t<h.length;t++){var e={},r=h[t];e["chinese_name"]=r["chinese_name"],e["english_name"]=r["english_name"],e["english_pro"]=r["english_name"],e["min_show_value"]=0,e["is_number"]=r["is_number"],e["english_unit"]=r["english_unit"],e["chinese_unit"]=r["chinese_unit"],e["is_unit_person"]=r["is_unit_person"],ot.push(e)}for(De(),ve(),ke(),s=0;s<o.detail_countries_name.length;s++){var n=o.detail_countries_name[s],a=ht[n];_e(a,n)}for(_e(ft,"world"),l["select"](".islands").selectAll("path").attr("fill",(function(){var t=re;return Pe(t,ne,ae)})),s=0;s<o.detail_countries_name.length;s++){var i=o.detail_countries_name[s],c=ht[i];Ae(c,i),de(c,i)}ge(!0),Ae(ft,"world"),de(ft,"world"),Me(!0),Ne(ot),Se();var p=window.location.href;if(console.log(p),Fe(ot),-1!=p.indexOf("?")){var u=p.split("?");console.log(u),-1!=u[1].indexOf("language=en")?fr():dr()}else fr();qe()}),500)}function ue(t){if(c=t.input_region_level_1,u=t.input_region_level_2,f=t.input_time_name,_=t.path_input_time,d=t.path_target_name,t.path_source_name,v=t.web_title,x=t.sub_tiltle,g=t.sub_tiltle_chinese,V=t.chinese_hint,F=t.english_hint,m=t.chinese_title,h=t.data_infos,A=t.axis_range,b=t.data_point,P=t.dataSource,S=t.data_url,k=t.mapSource,C=t.map_url,R=t.time_unit,_t=t.is_date_data,le=t.is_data2axis,k=t.mapSource,O=t.dataSource_chinese,D=t.use_dragBlock,j=t.use_brush,M=t.path_explain_chinese,T=t.path_explain_english,Mt=l["scaleLinear"]().domain([0,4]).range(["rgba(240,140,131,0.8)","rgba(187,0,0,0.9)"]).interpolate(l["interpolateHcl"]),"policy"==$){var e=["","rgb(242, 237, 204)","rgb(244, 218, 173)","rgb(237, 191, 163)","rgb(237, 170, 163)","rgb(212, 126, 152)","rgba(161, 63, 113,0.8)","rgba(106, 51, 109,0.8)"];l["range"](7).map((function(t){return e[t]}));Mt=l["scaleThreshold"]().domain([0,1,2,3,4,5,6]).range(e)}}function _e(t,e){Bt.selectAll("."+e).remove();var r=zt.append("defs"),n=r.append("filter").attr("id","f-shadow-province").attr("height","110%");n.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",2).attr("result","blurOut"),n.append("feOffset").attr("in","blur").attr("dx",1*mt).attr("dy",1*mt).attr("result","offsetBlur");var a=n.append("feMerge");a.append("feMergeNode").attr("in","offsetBlur"),a.append("feMergeNode").attr("in","SourceGraphic");var l=zt.append("defs"),i=l.append("filter").attr("id","drop-map-shadow").attr("height","300%").attr("width","300%");i.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",5*mt).attr("result","blur"),i.append("feOffset").attr("in","blur").attr("dx",2*mt).attr("dy",3*mt).attr("result","offsetBlur");var s=i.append("feMerge");s.append("feMergeNode").attr("in","offsetBlur"),s.append("feMergeNode").attr("in","SourceGraphic"),Bt.append("g").attr("class",e+" region"),Bt.selectAll("."+e).selectAll("path").data(t.features).enter().append("path").attr("d",Nt).attr("fill",(function(t,e){if(0!=Object.prototype.hasOwnProperty.call(t.properties,K)){t.properties.chinese_name;if("ASF"==$)return t.properties.stage<=y.id&&0!=t.properties[K][it]?Mt(t.properties.stage):void 0;var r,n=0;if(1==_t){var a=t.properties[K][ae];r=a-n}else r=t.properties.stage;for(var l=0;l<w.length;l++)if(r<=w[l].range[1]&&r>w[l].range[0])return Mt(l)}})).on("click",(function(t){1==t.properties.hasData&&(1==_t&&t.properties[K][String(it)],nr(t.properties))})).on("dblclick",(function(t){We(t.properties),0==U&&ar()})).on("mouseout",(function(t){0==U&&ar()})).attr("stroke",(function(t){if("西撒哈拉"==t.properties.chinese_name)return"rgba(200,200,200,0.5)"})).style("display",(function(t){return ye(t)})),Bt.append("g").attr("class","highlight_region_"+e+" highlight_region"),Bt.selectAll(".highlight_region_"+e).selectAll("path").data(t.features).enter().append("path").attr("d",Nt).attr("fill","none").attr("stroke",(function(t){return"rgba(40,40,40)"})).attr("stroke-width","0.04vw").attr("display",(function(t){return"none"}));var c=.32*jt;"china"==o.selectedMap&&(c=0);var p=c/150*200;Bt.append("image").attr("class","southsea").attr("xlink:href",(function(t,e){return"southchinasea.svg"})).attr("x",(function(t){return Ut([106,28])[0]})).attr("y",(function(t){return Ut([110,27])[1]})).attr("stroke-width","0.1%").attr("width",c).attr("height",p).style("fill","none").attr("opacity",(function(t){return.7})),"china"==o.selectedMap&&zt.append("image").attr("class","southsea_img").attr("xlink:href",(function(t,e){return"南海诸岛.svg"})).attr("x",(function(t){return.7*bt})).attr("y",(function(t){return.8*Ot})).attr("width",.130303*bt).attr("height",.1*Ot).attr("opacity",(function(t){return 1}))}function de(t,e){l["selectAll"](".mouseover_text_1"+e).remove(),Bt.selectAll(".mouseover_text_1"+e).data(t.features).enter().append("text").attr("class","mouseover_text_1 mouseover_text_1"+e).text((function(t){return""})).attr("fill","rgba(6,85,178,0.5)").attr("x",(function(t){if(0==t.properties.cp)return 0;var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[0]})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[1]+5}})).attr("font-size",(function(t,e){return 1996==t.properties[H]?8*mt:10*mt})).style("fill-opacity",0),l["selectAll"](".mouseover_text_2"+e).remove(),o.country_text_size=14*mt,l["selectAll"](".country_text"+e).remove(),Bt.selectAll(".country_text"+e).data(t.features).enter().append("text").attr("class","country_text country_text"+e).text((function(t){return t.properties.name.split(" ")[0]})).attr("fill","rgba(6,85,178,0.5)").attr("x",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[0]}})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[1]}})).attr("dx",(function(t,e){return t.properties.dx*mt})).attr("dy",(function(t,e){return t.properties.dy*mt})).on("click",(function(t){1==t.properties.hasData&&(1==_t&&t.properties[H][String(it)],nr(t.properties))})).on("dblclick",(function(t){We(t.properties)})).on("mouseout",(function(t){0==U&&ar()})).attr("font-size",(function(t,e){return-1!=xt.indexOf(t.properties.chinese_name)?.6*o.country_text_size:o.country_text_size})).attr("text-anchor","middle").attr("fill-opacity",1).attr("opacity",(function(t){return 0==Object.prototype.hasOwnProperty.call(t.properties,K)?.3:er(t,ne,it)>0?1:.3})).attr("display",(function(t){return fe(t)})),l["selectAll"](".country_text2"+e).remove(),Bt.selectAll(".country_text2"+e).data(t.features).enter().append("text").attr("class","country_text2 country_text2"+e).text((function(t){return 3==t.properties.name.split(" ").length?t.properties.name.split(" ")[1]+" "+t.properties.name.split(" ")[2]:t.properties.name.split(" ")[1]})).attr("fill","rgba(6,85,178,0.5)").attr("x",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[0]}})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[1]+o.country_text_size}})).attr("dx",(function(t,e){return t.properties.dx*mt})).attr("dy",(function(t,e){return t.properties.dy*mt})).on("click",(function(t){1==t.properties.hasData&&(1==_t&&t.properties[H][String(it)],nr(t.properties))})).on("dblclick",(function(t){We(t.properties)})).on("mouseout",(function(t){0==U&&ar()})).attr("font-size",(function(t,e){return-1!=xt.indexOf(t.properties.chinese_name)||t.properties.cp[0]<25.5&&t.properties.cp[0]>18&&t.properties.cp[1]<50&&t.properties.cp[1]>40?.6*o.country_text_size:o.country_text_size})).attr("text-anchor","middle").attr("fill-opacity",1).attr("opacity",(function(t){return 0==Object.prototype.hasOwnProperty.call(t.properties,K)?.3:er(t,ne,it)>0?1:.3})).attr("display",(function(t){return fe(t)})),l["selectAll"](".country_num_text"+e).remove(),Bt.selectAll(".country_num_text_shadow"+e).data(t.features).enter().append("text").attr("class","country_num_text_shadow country_num_text_shadow"+e).text((function(t){if(0!=t.properties.cp&&1==t.properties.hasData){var e="";return e=0==le?t.properties[H][ae]:t.properties[H],hr(e)}})).attr("x",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[0]}})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return t.properties.name.split(" ").length<2?e[1]+o.country_text_size:e[1]+2*o.country_text_size}})).style("text-anchor","middle").attr("dx",(function(t,e){return t.properties.dx*mt+.5*mt})).attr("dy",(function(t,e){return t.properties.dy*mt+.2*mt})).attr("font-size",(function(t,e){return-1!=xt.indexOf(t.properties.chinese_name)?10*mt:16*mt})).style("font-weight","bold").attr("fill-opacity",1).attr("opacity",.6).style("fill","rgba(160,160,160,0.7)").attr("display",(function(t){return fe(t)})),Bt.selectAll(".country_num_text"+e).data(t.features).enter().append("text").attr("class","country_num_text country_num_text"+e).text((function(t){if(0!=t.properties.cp&&1==t.properties.hasData){var e="";return e=0==le?t.properties[H][ae]:t.properties[H],hr(e)}})).attr("x",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[0]}})).attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return t.properties.name.split(" ").length<2?e[1]+o.country_text_size:e[1]+2*o.country_text_size}})).on("click",(function(t){1==t.properties.hasData&&(1==_t&&t.properties[H][String(it)],nr(t.properties))})).on("dblclick",(function(t){We(t.properties)})).on("mouseout",(function(t){0==U&&ar()})).style("text-anchor","middle").attr("dx",(function(t,e){return t.properties.dx*mt})).attr("dy",(function(t,e){return t.properties.dy*mt})).attr("font-size",(function(t,e){return-1!=xt.indexOf(t.properties.chinese_name)?.6*o.country_text_size:o.country_text_size})).style("font-weight","bold").attr("fill-opacity",1).attr("opacity",1).style("fill","rgba(95,0,0,0.97)").attr("display",(function(t){return fe(t)}))}function fe(t){var e=t.properties.chinese_name,r="?";1==Object.prototype.hasOwnProperty.call(t.properties,"temp_country")&&(r=t.properties.temp_country);var n=t.properties.cp;return 1==t.properties.region_level?"province"!=o.show_region_level||r!=o.temp_selected_country_chinese&&r!=o.temp_selected_country.replaceAll(" ","_")?"province"==o.show_region_level&&Gt>2?"":"none":"":"province"==o.show_region_level&&-1!=o.detail_countries_name.indexOf(e)?Gt>2?"none":"":Gt>2||t.properties[H][ae]>at?"":n[0]>-18&&n[0]<25&&n[1]>36&&n[1]<81||n[0]>-90&&n[0]<-50&&n[1]>8&&n[1]<22?"none":""}function he(t){var e=p()("#choose_circle").prop("checked");if(0==e)return"none";var r=t.properties.chinese_name;return 0!=t.properties.region_level?"country"==o.show_region_level?"none":"":"province"!=o.show_region_level?"":-1!=o.detail_countries_name.indexOf(r)?"none":void 0}function ye(t){var e=t.properties.chinese_name;return 0!=t.properties.region_level?"country"==o.show_region_level?"none":"":"province"!=o.show_region_level?"":-1!=o.detail_countries_name.indexOf(e)?"none":void 0}function ve(){se=.78*p()("#mapPanel").height();for(var t=[],e=Sr(ne,ae),r=parseInt(Sr(ne,ae)/5),n=0,a=0;;a++)if(t.push(n),n+=r,n+r>e){t.push(e);break}var o=l["axisBottom"](ce).tickValues(t).tickFormat((function(t){var e=Ar(ne,t);if("year"==R)return e;var r=e.split("/")[1],n=e.split("/")[2];return r+"/"+n})).tickSize(5.5*mt);zt.select(".axis").remove();zt.append("g").attr("class","axis").attr("transform","translate("+ie+","+se+")").call(o);var i=.015*bt;zt.selectAll(".point_text_shadow").remove(),zt.append("text").attr("class","point_text point_text_shadow").attr("font-size",25*mt).attr("x",(function(){return ie+Tt+i-.2*mt})).attr("y",(function(){return se+.05*Ot})).text((function(){return me(it)})).attr("fill","rgba(256,256,256,0.8)").style("fill-opacity",.9),zt.selectAll(".point_text2").remove();zt.append("text").attr("class","point_text point_text_shadow").attr("font-size",25*mt).attr("x",(function(){return ie+Tt+i-.2*mt})).attr("y",(function(){return se+.05*Ot})).text((function(){return me(it)})).style("fill-opacity",.9);var s=4*mt;zt.selectAll(".point_date_path").remove(),zt.selectAll(".point_date_path").data(b).enter().append("path").attr("class","point_date_path").attr("d",(function(){return"M 0,0  L "+-s+","+1.5*s+" L "+s+","+1.5*s+" L 0,0"})).attr("transform",(function(t){var e=t.year;return 1!=_t&&0!=le||(e=Sr(ne,e)),"translate("+(ie+ce(e))+","+se+")"})).attr("fill","rgb(50,50,50)").style("fill-opacity",.9),l["selectAll"](".point_line").remove();zt.append("path").attr("class","point_line").attr("d",(function(){})).attr("stroke","rgba(160,160,160,0.7)").attr("stroke-dasharray","3,3");if(l["selectAll"](".brush").remove(),l["selectAll"](".slide_rect").remove(),1==j){var c=l["brushY"]().extent([[ie-bt/60,se],[ie,se+oe]]).on("brush end",tr);zt.select(".brush").remove(),zt.append("g").attr("class","brush").call(c).call(c.move,[se,se+oe])}1==D&&ze(),Ke()}function me(t){for(var e=0;e<b.length;e++)if(parseInt(b[e].year)==parseInt(t))return"chinese"==gt?xr(t)+":"+b[e].chinese_event:xr(t)+":"+b[e].event;return""}function ge(t){if(0==t)return l["selectAll"](".links").remove(),void l["selectAll"](".mycircle").remove();var e=zt.append("defs"),r=e.append("linearGradient").attr("id","LinklinearColor_right").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),n=(r.append("stop").attr("offset","0%").style("stop-color","white"),r.append("stop").attr("offset","100%").style("stop-color","rgba(240,140,131)"),e.append("linearGradient").attr("id","LinklinearColor_left").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"));n.append("stop").attr("offset","0%").style("stop-color","rgba(240,140,131)"),n.append("stop").attr("offset","100%").style("stop-color","white");var a=zt.append("defs"),o=(a.append("marker").attr("id","arrow").attr("markerUnits","strokeWidth").attr("viewBox","0 0 10 10").attr("refX",5).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("path").attr("d","M2,2 L8,5 L2,8 L5,5 L2,2").attr("fill","rgba(240,240,240,0.8)"),a.append("filter").attr("id","drop-shadow").attr("height","140%"));o.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",4*mt).attr("result","blur"),o.append("feOffset").attr("in","blur").attr("dx",5*mt).attr("dy",6*mt).attr("result","offsetBlur");var i=o.append("feMerge");i.append("feMergeNode").attr("in","offsetBlur"),i.append("feMergeNode").attr("in","SourceGraphic"),l["selectAll"](".links").remove();Bt.selectAll(".links").data(yt).enter().append("path").attr("class","links").attr("d",(function(t){return or(t)})).attr("marker-end","url(#arrow)").attr("filter",(function(t){if(Math.abs(t.target.x-t.source.x)>15&&"Portugal"!=t.source.name)return"url(#drop-shadow)"})).on("mouseover",(function(){1,1})).on("mouseout",(function(){0,0})).style("stroke",(function(t){var e=Ut([t.source.x,t.source.y]),r=Ut([t.target.x,t.target.y]);return e[0]>r[0]?"url(#LinklinearColor_right)":"url(#LinklinearColor_left)"})).attr("opacity",(function(){return N}))}Bt.append("rect").attr("x",0).attr("y",0).attr("width",bt).attr("height",Ot).attr("fill","rgba(200,200,200,0)"),l["json"]("islands.json").then((function(t){Bt.append("g").attr("class","islands").selectAll(".path").data(t.features).enter().append("path").attr("d",Nt).attr("fill",(function(t){})).attr("stroke",(function(t){return"color(5)"})).style("stroke-width",(function(t){return"0.1%"}))})),p()("#choose_line").prop("checked",!0),p()("#choose_detail").prop("checked",!0),p()("#choose_country_name").prop("checked",!0),p()("#choose_circle").prop("checked",!0),p()("#choose_map").prop("checked",!0),pe(t,e,r,n,a);var xe={};function we(t){var e=lt[t].min,r=lt[t].max;if(-1!=o.detail_countries_name.indexOf(o.temp_selected_country_chinese)&&"province"==o.show_region_level&&(e=lt[o.temp_selected_country_chinese][H].min,r=lt[o.temp_selected_country_chinese][H].max),e>r)return[0,0];"Newly"!=X&&"Percent"!=X&&""!=ct[t.split("_")[0]]&&(r=lt[ct[t.split("_")[0]]+"_"+X].max*pt[t.split("_")[0]]);for(var n=Math.pow(10,parseInt(r).toString().length-1),a=[0,1,2,5,10],l=0;l<a.length;l++)if(a[l]*n>=r){r=a[l]*n;break}return[e,r]}function Ae(t,e){for(var r in ot){var n=ot[r].english_pro;xe[n]=0==r?"rgba(255,204,102,0.3)":1==r?"rgba(144,208,203,0.3)":"rgba(60,60,60,0.1)"}var a=H.split("_data")[0];st=l["scaleLinear"]().domain(we(a)).range([5*mt,B/2]),Bt.selectAll(".num_circle"+e).remove(),Bt.selectAll(".num_circle"+e).data(t.features).enter().append("circle").attr("class","num_circle num_circle"+e).attr("r",(function(t,e){return 0==Object.prototype.hasOwnProperty.call(t.properties,H)?0:st(t.properties[H][it])})).attr("cx",(function(t,e){var r=Ut(t.properties.cp);return r[0]})).attr("cy",(function(t,e){var r=Ut(t.properties.cp);return r[1]})).on("click",(function(t,e){1==t.properties.hasData&&(1==_t&&t.properties[H][String(it)],nr(t.properties))})).on("dblclick",(function(t){We(t.properties)})).on("mouseout",(function(){0==U&&ar()})).attr("fill","rgba(253,187,132,0.4)").attr("stroke","rgba(256,256,256,0.7)").attr("stroke-width",.45*mt).attr("cursor","pointer").attr("display",(function(t){if("none"==he(t))return"none";var e=p()("#choose_circle").prop("checked");return 1==e?"":"none"})),Se()}function be(){var t=K.split("_data")[0],e=Le(lt[t].max,"int");""!=o.temp_selected_country_chinese&&"province"==o.show_region_level&&-1!=o.detail_countries_name.indexOf(o.temp_selected_country_chinese)&&(e=Le(lt[o.temp_selected_country_chinese][K].max,"int")),w=[];for(var r=0;r<e.length-1;r++){if(e[r]>lt[t].max)break;w.push({name:e[r]+" - "+e[r+1],id:r,range:[e[r],e[r+1]]})}ke(),l["selectAll"](".region").selectAll("path").attr("fill",(function(t,e){return Pe(t,ne,it)}))}function Pe(t,e,r){if(1==Object.prototype.hasOwnProperty.call(t,"properties")&&(t=t.properties),0!=Object.prototype.hasOwnProperty.call(t,K)){if("policy"==$)return"中国"==t.chinese_name?"rgba(210,210,210,1)":1==t.hasData?Mt(t.stage):"rgb(160,160,160)";if(0==le){var n=0;if(parseInt(e)!=ne){var a=Ar(ne,Sr(ne,parseInt(e))-1).replaceAll("/","");n=t[K][a]}for(var l=t[K][r.toString()],o=l-n,i=0;i<w.length;i++)if(o<=w[i].range[1]&&o>w[i].range[0])return Mt(i)}else if(1==_t){var s=Sr(ee,t[K]);if(s>=e&&s<=r)return Mt(t.stage)}else{if(5!=t.properties[K].length)return t[K]>=e&&t[K]<=r?Mt(t.stage):"rgb(160,160,160)";var c=parseInt(t[K].substr(0,4));if(c>=e&&c<=r)return Mt(t.stage)}}}function Oe(){var t=H.split("_data")[0],e=we(t);st=l["scaleLinear"]().domain(e).range([5*Dt,B/2]),Gt>2&&"Percent"!=X&&"province"==o.show_region_level&&(st=l["scaleLinear"]().domain([e[0],e[1]]).range([5*Dt/Gt*2,B/2/Gt*4])),l["selectAll"](".num_circle").attr("r",(function(t,e){if(0==Object.prototype.hasOwnProperty.call(t.properties,H))return 0;if(0==le){var r=0,n=t.properties[H][parseInt(it).toString()];return isNaN(n-r)||n-r==0?0:st(n-r)}})).attr("display",(function(t){return he(t)}))}function Se(){Oe();var t=st.domain();if(0==t[0]&&0==t[1])return zt.selectAll(".circle_pro_explain").remove(),zt.selectAll(".explain_circle").remove(),void zt.selectAll(".circle_text").remove();var e=.17*Ot,r=l["scaleLinear"]().domain(t).range([0,e]),n=[],a=Math.pow(10,parseInt((t[1]-1)/Gt).toString().length-1);Gt>2&&(a=Math.pow(10,parseInt(t[1]/Gt/3).toString().length-1));for(var o=[0,1,2,5,10],i=0;i<o.length;i++)if(0==i)n.push(t[0]);else{if(st(a*o[i])*Gt/Yt*2>B)break;n.push(a*o[i])}l["axisLeft"]().scale(r).tickValues(n).tickSize(2*mt);var s=.07*bt+st(n[n.length-1])*Gt,c=.25*Ot;zt.selectAll(".circle_pro_explain").remove(),zt.append("text").attr("class","circle_pro_explain").attr("x",s).attr("y",c-8*mt).text((function(){var t=ot[et].english_pro,e=W[X].english;return"chinese"==gt&&(t=ot[et].chinese_name,e=W[X].chinese),t+" ("+e+")"})).attr("text-anchor","middle").attr("font-size",9*mt),n.reverse(),zt.selectAll(".explain_circle").remove(),zt.selectAll(".explain_circle").data(n).enter().append("circle").attr("class","explain_circle").attr("cx",(function(t){return s})).attr("cy",(function(t){return c+st(t)*Gt})).attr("r",(function(t){return st(t)*Gt})).attr("fill",(function(t,e){if(0!=e)return"none";var r=H.split("_")[0];return xe[r]})).attr("stroke","rgba(256,256,256,0.7)").attr("stroke-width","0.11%").style("display",(function(){var t=p()("#choose_circle").prop("checked");return 1==t?"":"none"})),zt.selectAll(".circle_text").remove(),zt.selectAll(".circle_text").data(n).enter().append("text").attr("class","circle_text").text((function(t){return 1==rt?t+"%":t})).attr("x",s).attr("y",(function(t){return c+2*st(t)*Gt+8*mt})).attr("font-size",9*mt).style("display",(function(){var t=p()("#choose_circle").prop("checked");return 1==t?"":"none"})).style("text-anchor","middle")}function ke(){var t=.04*bt;"policy"==$&&(t=bt/10);var e=0;B=.115*Ot,0!=w.length&&(e=.115*Ot/w.length),e=.115*Ot/6*Yt;var r=.25*Ot+e;zt.selectAll(".map_pro_explain").remove(),zt.append("text").attr("class","map_pro_explain").attr("x",ie).attr("y",r-e-8*mt).text((function(){var t=ot[tt].english_pro,e=W[J].english;return"chinese"==gt&&(t=ot[tt].chinese_name,e=W[J].chinese),t+" ("+e+")"})).attr("font-size",9*mt),zt.selectAll(".no_data_rect").remove(),zt.append("rect").attr("class","no_data_rect").attr("width",t).attr("height",e).attr("y",r-e).attr("x",ie).attr("fill","rgb(160,160,160)").on("mouseover",(function(){Ce()})).on("mouseout",(function(){Qe()})).style("stroke","white").style("stroke-opacity",.6),zt.selectAll(".no_data_text").remove(),zt.append("text").attr("class","no_data_text").text((function(){return"english"==gt?"No data":"无数据"})).attr("y",r-1*e+12*mt).attr("x",ie+.05*t).attr("font-size",(function(t){return 10*mt})).attr("fill","white").on("mouseover",(function(){Ce()})).on("mouseout",(function(){Qe()})),l["selectAll"](".range_rect").remove();zt.selectAll(".range_rect").data(w).enter().append("rect").attr("class","range_rect").attr("x",(function(t,e){return ie})).attr("y",(function(t,n){return r+e*n})).attr("width",(function(e,r){return t})).attr("height",(function(t){return e})).attr("fill",(function(t,e){return Mt(t.id)})).style("stroke","white").style("stroke-opacity",.6).on("mouseover",(function(t,e){Xe(t)})).on("mouseout",(function(t,e){Qe(t)}));l["selectAll"](".range_name").remove();zt.selectAll(".range_name").data(w).enter().append("text").attr("class","range_name").attr("font-size",(function(t){return 12*mt})).on("mouseover",(function(t,e){Xe(t)})).on("mouseout",(function(t,e){Qe(t)})).attr("x",(function(e,r){return ie+.05*t})).attr("y",(function(t,n){return r+e*n+11*mt})).text((function(t,e){return 1==nt?t.name+"%":""+t.name})).attr("stroke",(function(){if("policy"==$)return"rgb(100,100,100)"})).style("stroke-width",(function(){if("policy"==$)return.1*mt}))}function Ce(){l["selectAll"](".links").attr("opacity",0),l["selectAll"](".region").selectAll("path").attr("fill",(function(t){return""})).attr("opacity",(function(t){return 1==je(t,it)?.2:1})),l["selectAll"](".country_text").attr("display",(function(t){return 1==je(t,it)||"none"==ye(t)?"none":""})).attr("opacity",(function(t){return 1==je(t,it)?0:1})),l["selectAll"](".country_text2").attr("display",(function(t){return 1==je(t,it)||"none"==ye(t)?"none":""})).attr("opacity",(function(t){return 1==je(t,it)?0:1})),l["selectAll"](".num_circle").attr("r",(function(t){return 0})),l["selectAll"](".country_num_text").attr("display",(function(t){return 1==je(t,it)||"none"==ye(t)?"none":""})),l["selectAll"](".country_num_text_shadow").attr("display",(function(t){return 1==je(t,it)||"none"==ye(t)?"none":""}))}function je(t,e){if(0==Object.prototype.hasOwnProperty.call(t.properties,K))return 0;var r,n=0;if(1==_t){var a=t.properties[K][it.toString()];r=a-n}else r=t.properties.stage;if(r>0)return 1;if(-1==K.indexOf(h[0].english_name)){var l=t.properties[h[0].english_name+"_Total_data"][it.toString()];return l>0?0:1}return 0}function De(){l["select"](".explain_panel").remove();l["select"]("#mapPanel").append("div").attr("class","explain_panel").style("position","absolute").style("left",(kt+ie)/p()("#mapPanel").width()*100+"%").style("top",(Ct+.89*Ot)/o.height*100+"%").style("width",(function(){return bt>Ot?"32%":"54%"})).style("height",(function(){return bt>Ot?"7%":"4%"})).html(V+"<br/>(* 国界仅为参考，不作为划界依据)").style("line-height",1.2).style("font-size",(function(){return bt>Ot?"1.3vmin":"0.5vmin"})).style("color","rgb(80,80,80)").style("z-index",1).style("text-align","left");l["selectAll"](".source_text").remove();l["select"]("#map_floor").append("text").attr("class","source_text source1").style("position","absolute").style("right","5%").style("top","0%").style("font-size","80%").text("Data Source: "+P).style("cursor","pointer").on("click",(function(){window.open(""+S)})),l["select"]("#map_floor").append("text").attr("class","source_text source2").style("position","absolute").style("right","5%").style("top","35%").style("font-size","80%").text("Map Source: github.com/johan/world.geo.json").style("cursor","pointer").on("click",(function(){window.open(""+C)}));l["select"]("#logo").style("left",(function(){return(kt+ie)/bt*100+"%"}));var t=.026*bt;"world"!=o.selectedMap&&(t*=1.3);var e=t,r=.96*bt-3.4*t;"world"!=o.selectedMap&&(r=.96*bt-2.2*t);var n=.06*Ot,a=[{id:"Global",loc_name:"全球",t_dx:0,t_dy:0,t_scale:1},{id:"Europe",loc_name:"欧洲",t_dx:.16*-bt,t_dy:.5*-Ot,t_scale:3},{id:"Asia",loc_name:"亚洲",t_dx:.7*-bt,t_dy:.93*-Ot,t_scale:2.7},{id:"Africa",loc_name:"非洲",t_dx:.065*-bt,t_dy:.93*-Ot,t_scale:2.3},{id:"Mid East",loc_name:"中东",t_dx:.68*-bt,t_dy:1.55*-Ot,t_scale:4.2},{id:"South America",loc_name:"南美",t_dx:1.32*-bt,t_dy:1.15*-Ot,t_scale:2.2}];"world"!=o.selectedMap&&(a=[{id:"Reset",id2:"Scale",loc_name:"重置 范围",t_dx:0,t_dy:0,t_scale:1}]),zt.selectAll(".zoom_icon").remove(),zt.selectAll(".zoom_icon").data(a).enter().append("image").attr("class",(function(t){return"zoom_icon zoom_icon_"+t.id})).attr("xlink:href",(function(t,e){return 0==e?"icon/"+t.loc_name+"-点.svg":"icon/"+t.loc_name+"-未点.svg"})).attr("x",(function(e,n){return n<3?r+1.2*t*n:r+1.2*t*(n-3)})).attr("y",(function(t,r){return r<3?n:n+1.1*e})).attr("width",t).attr("height",e).style("fill","none").attr("opacity",(function(t){return 1})).on("click",(function(t){Te(t.id,t.loc_name,t.t_scale*Yt,t.t_dx+Jt,t.t_dy)})).style("cursor","pointer"),zt.selectAll(".zoom_icon_text").remove(),zt.selectAll(".zoom_icon_text").data(a).enter().append("text").attr("class",(function(t){return"zoom_icon_text zoom_icon_text"+t.id})).text((function(t){return t.loc_name.split(" ")[0]})).attr("x",(function(n,a){return a<3?r+a*e*1.2+.5*t:r+(a-3)*e*1.2+.5*t})).attr("y",(function(t,r){return r<3?n:n+1.1*e})).attr("dy",(function(t,r){var n=.6*e;return t.id.split(" ").length>1&&(n=.5*e),n})).attr("font-size",.27*t).attr("font-weight","bold").style("fill","white").style("opacity",(function(t){return.7})).on("click",(function(t){Te(t.id,t.loc_name,t.t_scale*Yt,t.t_dx+Jt,t.t_dy)})).style("cursor","pointer").style("text-anchor","middle"),zt.selectAll(".zoom_icon_text2").remove(),zt.selectAll(".zoom_icon_text2").data(a).enter().append("text").attr("class",(function(t){return"zoom_icon_text2 zoom_icon_text2"+t.id})).text((function(t){return t.loc_name.split(" ")[1]})).attr("x",(function(n,a){return a<3?r+a*e*1.2+.5*t:r+(a-3)*e*1.2+.5*t})).attr("y",(function(t,r){return r<3?n:n+1.1*e})).attr("dy",(function(t,r){var n=.6*e;return t.id.split(" ").length>1&&(n=.7*e),n})).attr("font-size",.27*t).attr("font-weight","bold").style("fill","white").style("opacity",(function(t){return.7})).on("click",(function(t){Te(t.id,t.loc_name,t.t_scale*Yt,t.t_dx+Jt,t.t_dy)})).style("cursor","pointer").style("text-anchor","middle"),l["select"]("#select_region_level").style("left",r/bt*100+"%").style("top",(n+1.1*e)/Ot*100+"%").style("width",(bt-r-kt)/bt*100+"%").style("display",(function(){return o.detail_countries_name.length>1?"":"none"})),l["select"]("#select_region_level").selectAll(".region_button_divs").remove(),l["select"]("#select_region_level").selectAll(".region_text_divs").remove(),l["select"]("#select_region_level").append("div").style("position","absolute").style("left","0vw").style("top","1vw").attr("id","region_button_div"),l["select"]("#select_region_level").append("div").style("position","absolute").style("left","1vw").style("top","1vw").attr("id","region_text_div"),l["select"]("#select_region_level").select("#region_button_div").selectAll(".region_button_divs").data(["country","province"]).enter().append("div").attr("class","region_button_divs").style("position","absolute").style("height","0.4vw").style("width","0.4vw").style("top",(function(t,e){return 0==e?"":"1vw"})).style("background-color",(function(t){return t==o.show_region_level?"rgba(60,60,60,0.4)":"rgba(256,256,256,0.8)"})).style("border",(function(t){return".2vw solid rgba(256,256,256,0.8)"})).on("click",(function(t){o.show_region_level=t,be(),Se(),rr(ne,it),l["selectAll"](".region_button_divs").style("background-color",(function(t){return t==o.show_region_level?"rgba(60,60,60,0.4)":"rgba(256,256,256,0.8)"}))})).style("cursor","pointer").style("border-radius","50%"),l["select"]("#select_region_level").select("#region_text_div").selectAll(".region_text_divs").data(["country","province"]).enter().append("div").attr("class","region_text_divs").attr("id",(function(t){return t+"_level"})).style("position","absolute").style("top",(function(t,e){return 0==e?"":"1vw"})).style("width","5vw").html((function(t){return t})).on("click",(function(t){o.show_region_level=t,be(),Se(),rr(ne,it),l["selectAll"](".region_button_divs").style("background-color",(function(t){return t==o.show_region_level?"rgba(60,60,60,0.4)":"rgba(256,256,256,0.8)"}))})).style("cursor","pointer"),l["selectAll"](".overview_country").remove(),l["selectAll"](".overview_num").remove();var i=.1*Ot;l["selectAll"](".hide_rect_left").remove(),zt.append("rect").attr("class","hide_rect_left").attr("x",.6*ie).attr("y",i).attr("width",.13*bt).attr("height",21*mt*5).attr("fill","rgba(200,200,200,0.6)");zt.append("text").attr("class","overview_country overview_info").attr("x",ie-4*mt).attr("y",i+30*mt).text((function(){return"Countries/Territories with Cases"})).attr("font-size",24*mt).style("text-anchor","left").style("fill","rgb(0,0,0)").attr("opacity",1);zt.append("text").attr("class","overview_country_num overview_info").attr("x",ie-4*mt).attr("y",i+30*mt).text((function(){return": "+ft.overview[ae.toString()].country_num})).attr("font-size",28*mt).style("text-anchor","left").style("fill","rgb(0,0,0)").attr("opacity",1).attr("font-weight","bold");zt.selectAll(".overview_name").data(ot).enter().append("text").attr("class","overview_name overview_info").attr("x",ie-4*mt).attr("y",(function(t,e){return i+31*mt*(e+2)})).text((function(t){return"Total "+t.english_pro+" Cases"})).attr("font-size",26*mt).style("text-anchor","left").style("fill","rgb(0,0,0)").attr("opacity",1),zt.selectAll(".overview_num").data(ot).enter().append("text").attr("class","overview_num overview_info").attr("x",ie-4*mt+.08*bt).attr("y",(function(t,e){return i+31*mt*(e+2)})).text((function(t){return": "+vr(ft.overview[ae.toString()][t.english_pro+"_Total_data"])})).attr("font-size",28*mt).style("text-anchor","left").style("fill","rgb(0,0,0)").attr("opacity",1).attr("font-weight","bold");zt.append("text").attr("class","selected_country selected_country_info").attr("x",ie-4*mt).attr("y",i+30*mt).text((function(){return"Selected Country"})).attr("font-size",24*mt).style("text-anchor","left").style("fill","rgb(0,0,0)").style("display","none"),zt.append("text").attr("class","selected_country_name selected_country_info").attr("x",ie-4*mt).attr("y",i+30*mt).text((function(){return": "+o.temp_selected_country})).attr("font-size",28*mt).style("text-anchor","left").style("fill","rgb(0,0,0)").style("display","none").attr("font-weight","bold"),zt.selectAll(".selected_country_pro").data(ot).enter().append("text").attr("class","selected_country_pro selected_country_info").attr("x",ie-4*mt).attr("y",(function(t,e){return i+31*mt*(e+2)})).text((function(t){return"Total "+t.english_pro+" "+t[gt+"_unit"]})).attr("font-size",26*mt).style("text-anchor","left").style("fill","rgb(0,0,0)").style("display","none"),zt.selectAll(".selected_country_num").data(ot).enter().append("text").attr("class","selected_country_num selected_country_info").attr("x",ie-4*mt+.08*bt).attr("y",(function(t,e){return i+31*mt*(e+2)})).text((function(t){return""})).attr("font-size",28*mt).style("text-anchor","left").style("fill","rgb(0,0,0)").style("display","none").attr("font-weight","bold"),l["selectAll"](".range_text").remove();zt.append("text").attr("class","range_text").attr("x",ie-4*mt).attr("y",i-10*mt).text(ne+"-"+ae).attr("font-size",30*mt).style("text-anchor","left").style("fill","rgb(100,100,100)").attr("opacity",1)}function Te(t,e,r,n,a){t,zt.selectAll(".zoom_icon").attr("xlink:href",(function(e,r){return e.id==t?"icon/"+e.loc_name+"-点.svg":"icon/"+e.loc_name+"-未点.svg"})),Gt=r,Wt=n*p()("#mapPanel").height()/Ot,$t=a*p()("#mapPanel").height()/Ot,a,n,o.temp_selected_country="",o.temp_selected_country_chinese="",Zt(),te(1e3)}function Me(t){if(l["selectAll"](".button_circle").remove(),l["selectAll"](".button_stop").remove(),l["selectAll"](".button_rect").remove(),0!=t){Tt=.015*Ot;var e=[ie+Tt,se+3*Tt],r=zt.append("defs"),n=r.append("linearGradient").attr("id","linearColor").attr("x1","0%").attr("y1","0%").attr("x2","80%").attr("y2","0%");n.append("stop").attr("offset","0%").style("stop-color","rgb(200,200,200)"),n.append("stop").attr("offset","100%").style("stop-color","white"),zt.append("circle").attr("class","button_circle").attr("r",Tt).attr("cx",e[0]).attr("cy",e[1]).on("click",(function(t){a()})).attr("stroke","rgba(150,150,150,0.7)").attr("stroke-width",3).style("fill","url(#"+n.attr("id")+")").style("fill-opacity",1),zt.append("rect").attr("class","button_stop").attr("x",e[0]-2*Tt/5).attr("y",e[1]-Tt/2).attr("width",Tt/5).attr("height",Tt).attr("fill","rgb(160,160,160)").attr("fill-opacity",0).on("click",(function(t){a()})),zt.append("rect").attr("class","button_stop").attr("x",e[0]+Tt/5).attr("y",e[1]-Tt/2).attr("width",Tt/5).attr("height",Tt).attr("fill","rgb(160,160,160)").attr("fill-opacity",0).on("click",(function(t){})),zt.append("path").attr("class","button_rect").attr("d","M "+(e[0]+Tt/2)+","+e[1]+" L"+(e[0]-Tt/3)+","+(e[1]-Tt/2)+" L"+(e[0]-Tt/3)+","+(e[1]+Tt/2)).attr("fill","rgb(160,160,160)").on("click",(function(t){a()}))}function a(){E=1-E,0==E?(l["selectAll"](".button_stop").attr("opacity",0),l["selectAll"](".button_rect").attr("opacity",1)):(l["selectAll"](".button_stop").attr("opacity",1),l["selectAll"](".button_rect").attr("opacity",0)),console.log("circe "+E),console.log("isEnd "+L),1==L&&(L=0,E=1,console.log("isEnd "+L),console.log("start"),lr(it!=ae?it:ne,ae))}}function ze(){var t=18*mt,e=2*t;Ot>=bt&&(t=19*mt);var r=ae,n=function(){L=1;l["select"](this).attr("class");var e=l["event"].x-t/2;if(e>=ie-.8*t&&e<=ie+oe){l["select"](".slide_rect").attr("x",e);var n=l["event"].x-ie;1==_t||0==le?(it=parseInt(Ar(ne,parseInt(n*Sr(ne,ae)/oe)).replaceAll("/","")),it>ae&&(it=ae)):it=ne+parseInt(n*(ae-ne)/oe),it!=r&&(rr(ne.toString(),it),r=it)}},a=l["drag"]().on("drag",n);l["selectAll"](".slide_rect").remove();var o=zt.append("rect").attr("class","slide_rect").attr("width",t).attr("height",e).attr("x",(function(){return ie+oe*Sr(ne,it)/Sr(ne,ae)-8*mt})).attr("y",se-e/2).attr("fill","rgb(160,160,160)").attr("stroke","white").attr("stroke-width",2*mt).attr("pointer","cursor").style("opacity",.7);it=ae.toString(),l["selectAll"](".range_text").text(xr(it)),o.call(a)}var Ie={GDP:"rgba(187,0,0,0.9)",Confirmed:"rgba(187,0,0,0.9)",Recovered:"rgba(58,108,59,0.9)",Dead:"rgba(13,27,60,0.65)"},Ee={GDP:"rgba(255,204,102,0.7)",Confirmed:"rgba(255,204,102,0.7)",Recovered:"rgba(144,208,203,0.8)",Dead:"rgba(60,60,60,0.2)"};function Le(t,e){var r=[],n=0;if(0==t)return r=[0],r;if(t>10){for(n=1;;n++)if(Math.pow(10,n+1)>=t)break;var a=t/Math.pow(10,n),l=Math.pow(10,n);r=t>1e5?[0,100,1e3,1e4,1e5,10*l]:a>5?[0,l/10,l/2,2*l,5*l,10*l]:[0,l/10,2*l/10,5*l/10,l,5*l]}else{for(n=0;;n--)if(Math.pow(10,n)<t)break;var o=Math.pow(10,n);r=[0,Ue(2,o),Ue(4,o),Ue(6,o),Ue(8,o),Ue(10,o)]}return r}function Ue(t,e){var r=0,n=t.toString(),a=e.toString();return n.includes(".")&&(r+=n.split(".")[1].length),a.includes(".")&&(r+=a.split(".")[1].length),Number(n.replace(".",""))*Number(a.replace(".",""))/Math.pow(10,r)}function Ne(t){l["select"]("#OptionContent").remove();var e=l["select"]("#OptionPanel").append("div").attr("id","OptionContent"),r=.027*Ot;St>=Pt&&(r=.018*Ot);var n=r*t.length+.05*p()("#mapPanel").height(),a=.14*bt;St>=Pt&&(a=.2*bt);var o=.115*Ot*Yt*1.2,i=.25*Ot+o;l["select"]("#OptionPanel").style("width",a/p()("#mapPanel").width()*100+"%").style("height",n/p()("#mapPanel").height()*100+"%").style("left",(kt+ie)/p()("#mapPanel").width()*100+"%").style("top",i/p()("#mapPanel").height()*100+"%").style("display",""),l["select"]("#checkboxPanel").style("left",(kt+ie)/p()("#mapPanel").width()*100+"%").style("top",(i+n+.01*p()("#mapPanel").height())/p()("#mapPanel").height()*100+"%").style("width",(function(){if(Ot>=bt)return"17vmin"})).style("display",""),l["select"]("#OptionPanelCursor").on("click",(function(){Ve()})),e.selectAll(".map_pro_type_div").remove(),e.append("div").attr("class","map_pro_type_div select_pro_div").style("left","40%").html((function(){return q[Q][gt+"_short"]})).style("background-color","rgba(256,256,256,0.6)").on("click",(function(){e.selectAll(".map_pro_tyeps").style("display","")})).on("mouseout",(function(){e.selectAll(".map_pro_tyeps").style("display","none")})),e.selectAll(".map_pro_tyeps").remove(),e.selectAll(".map_pro_tyeps").data(q).enter().append("div").attr("class","map_pro_tyeps expand_pro_div").style("width","60%").style("left","40%").style("top",(function(t,e){return bt>Ot?.6-2*(e+1)+"vh":.3-1*(e+1)+"vh"})).style("height",(function(t,e){return bt>Ot?void 0:"1vh"})).html((function(t,e){return t[gt]})).on("mouseover",(function(t,r){e.selectAll(".map_pro_tyeps").style("display",""),e.selectAll(".map_pro_tyeps").style("background-color",(function(t,e){return e==r?"rgba(200,200,200)":void 0}))})).on("click",(function(t,r){Q=r,J=t.english_short,K=K.split("_")[0]+"_"+J+"_data",nt="Percent"==J?1:0,e.selectAll(".map_pro_type_div").html((function(){return q[Q][gt+"_short"]})),c(K.split("_data")[0]),e.selectAll(".map_pro_tyeps").style("display","none")})).on("mouseout",(function(){e.selectAll(".map_pro_tyeps").style("display","none")})).style("display","none"),e.selectAll(".circle_pro_type_div").remove(),e.append("div").attr("class","circle_pro_type_div select_pro_div").style("left","70%").html((function(){return q[Z][gt+"_short"]})).style("background-color","rgba(256,256,256,0.6)").on("click",(function(){e.selectAll(".circle_pro_tyeps").style("display","")})).on("mouseout",(function(){e.selectAll(".circle_pro_tyeps").style("display","none")})),e.selectAll(".circle_pro_tyeps").remove(),e.selectAll(".circle_pro_tyeps").data(q).enter().append("div").attr("class","circle_pro_tyeps expand_pro_div").style("width","60%").style("left","70%").style("top",(function(t,e){return bt>Ot?.6-2*(e+1)+"vh":.3-1*(e+1)+"vh"})).style("height",(function(t,e){return bt>Ot?void 0:"1vh"})).html((function(t,e){return t[gt]})).on("mouseover",(function(t,r){e.selectAll(".circle_pro_tyeps").style("display",""),e.selectAll(".circle_pro_tyeps").style("background-color",(function(t,e){return e==r?"rgba(200,200,200)":void 0}))})).on("click",(function(t,r){Z=r,X=t.english_short,rt="Percent"==X?1:0,H=H.split("_")[0]+"_"+X+"_data",e.selectAll(".circle_pro_type_div").html((function(){return q[Z][gt+"_short"]})),u(H.split("_data")[0]),e.selectAll(".circle_pro_tyeps").style("display","none")})).on("mouseout",(function(){e.selectAll(".circle_pro_tyeps").style("display","none")})).style("display","none"),Ot>=bt&&(l["selectAll"](".select_pro_div").style("top","0.3vh").style("font-size","0.6vh").style("height","1vh"),l["selectAll"](".expand_pro_div").style("font-size","0.6vh"),l["select"]("#choose_map_div").style("top","1.5vh"),l["select"]("#choose_map_text").style("left","1vh").style("font-size","0.6vh"),l["select"]("#choose_circle_div").style("top","1.5vh"),l["select"]("#choose_circle_text").style("left","1vh").style("font-size","0.6vh"),l["select"]("#select_region_level").style("font-size","0.6vh"));var s=.05*p()("#mapPanel").height();function c(t){K=t+"_data",l["selectAll"](".map_pro_selection").style("opacity",(function(e,r){return e.english_pro==t.split("_")[0]?1:.3})).style("border-width",(function(e,r){return e.english_pro==t.split("_")[0]?"0.23vmin":".1vmin"})).style("display",(function(t,e){return Re(t,"map",J)})),sr("Confirmed_Total_data"==K||"false"),be(),Mt=-1!=K.indexOf("Confirmed")||-1!=K.indexOf("GDP")?l["scaleLinear"]().domain([0,w.length-1]).range(["rgba(240,140,131,0.8)","rgba(187,0,0,0.9)"]).interpolate(l["interpolateHcl"]):-1!=K.indexOf("Recovered")?l["scaleLinear"]().domain([0,w.length-1]).range(["rgba(144,200,137,0.6)","rgba(58,108,59,0.9)"]).interpolate(l["interpolateHcl"]):l["scaleLinear"]().domain([0,w.length-1]).range(["rgba(13,27,87,0.35)","rgba(13,27,60,0.85)"]).interpolate(l["interpolateHcl"]),ke(),rr(ne,it)}function u(e){H=e+"_data",Y=1,ut=e,at=.1*lt[e].max,l["selectAll"](".circle_pro_selection").style("opacity",(function(t,r){return e.split("_")[0]==t.english_pro?1:.35})).style("border-width",(function(t,r){return e.split("_")[0]==t.english_pro?"0.23vmin":".1vmin"})).style("display",(function(t,e){return Re(t,"circle",X)})),l["selectAll"](".pro_explain_text").text((function(){for(var e in t)if(t[e].english_pro==H.split("_data")[0])return"chinese"==gt?""+t[e].explain_chinese:""+t[e].explain_english})),sr("Confirmed_Total_data"==K||"false"),st=(H.indexOf("PMP"),l["scaleLinear"]().domain(we(H.split("_data")[0])).range([5*mt,B/2])),Se(),l["selectAll"](".num_circle").attr("fill",(function(){return xe[H.split("_")[0]]})),rr(ne,it)}e.selectAll(".property_title_text").remove(),e.append("text").attr("class","property_title_text").style("position","absolute").style("width","40%").style("left","0").style("top",(function(){return(s-.02*St)/n*100+"%"})).text((function(t,e){return"chinese"==gt?"统计类型":"Statistical Type"})).style("text-align","center").style("font-size",(function(){return"80%"})).style("font-weight","bold"),e.selectAll(".property_name_text").remove(),e.selectAll(".property_name_text").data((function(){return ot})).enter().append("text").attr("class","property_name_text").style("position","absolute").style("width","40%").style("left","0").style("top",(function(t,e){return(e*r+s)/n*100+"%"})).text((function(t,e){return"chinese"==gt?t.chinese_name+" "+t.chinese_unit:t.english_name+" "+t.english_unit})).on("click",(function(t,e){var r=t.english_pro,n=t.english_pro;r=r+"_"+J,n=n+"_"+X,"none"!=Re(t,"map",J)&&(tt=e,K=r+"_data",c(r)),"none"!=Re(t,"circle",X)&&(et=e,H=n+"_data",u(n))})).style("cursor","pointer").style("text-align","center").style("font-size","80%"),e.selectAll(".map_pro_selection").remove(),e.selectAll(".map_pro_selection").data(t).enter().append("div").attr("class","map_pro_selection").style("position","absolute").style("left","45%").style("top",(function(t,e){return(e*r+s)/n*100+"%"})).style("width",1.5*r/a*100+"%").style("height",(function(t,e){return.7*r/n*100+"%"})).style("background-color",(function(t,e){var r=t.english_pro;return Ie[r]})).style("opacity",(function(t){var e=t.english_pro+"_"+J;return e==K.split("_data")[0]?1:.3})).on("click",(function(t,e){var r=t.english_pro+"_"+J;tt=e,c(r)})).style("cursor","pointer").style("border","solid rgba(256,256,256,1)").style("border-width",(function(t,e){var r=t.english_name+"_"+J;return r==K.split("_data")[0]?"0.23vmin":".1vmin"})).style("margin-left","0.23vmin").style("display",(function(t,e){return Re(t,"map",J)})),e.selectAll(".circle_pro_selection").remove(),e.selectAll(".circle_pro_selection").data(t).enter().append("div").attr("class","circle_pro_selection").style("position","absolute").style("left","78%").style("top",(function(t,e){return(e*r+s)/n*100+"%"})).style("width",.7*r/a*100+"%").style("height",(function(t,e){return.7*r/n*100+"%"})).style("border-radius","50%").style("background-color",(function(t,e){var r=t.english_pro;return Ee[r]})).style("opacity",(function(t,e){var r=t.english_name+"_"+X;return r==H.split("_data")[0]?1:.35})).on("click",(function(t,e){var r=t.english_pro+"_"+X;et=e,u(r)})).style("cursor","pointer").style("border","solid rgba(250,250,250,1)").style("border-width",(function(t,e){var r=t.english_name+"_"+X;return r==H.split("_data")[0]?"0.23vmin":".1vmin"})).style("display",(function(t,e){return Re(t,"circle",X)})),l["select"]("#OptionPanelCursor").attr("class","contract_cursor")}function Re(t,e,r){if("circle"==e){if("Total"==r||"Newly"==r||"Per KM2"==r)return 0==t.is_number?"none":"";if("Percent"==r)return""==ct[t.english_pro]?"none":"";if("PMP"==r)return 0==t.is_unit_person?"none":""}else if("map"==e){if("Total"==r)return"";if("Newly"==r||"Per KM2"==r)return 0==t.is_number?"none":"";if("Percent"==r)return""==ct[t.english_pro]?"none":"";if("PMP"==r)return 0==t.is_unit_person?"none":""}}var Be=1;function Ve(){if(1==Be){var t=.115*Ot*Yt*1.2,e=.25*Ot+t;l["select"]("#checkboxPanel").style("top",(e+.08*p()("#mapPanel").height())/p()("#mapPanel").height()*100+"%"),l["select"]("#OptionPanelText").text((function(){return"chinese"==gt?"展开切换数据类型":"Expand to change statistical type"})),l["select"]("#choose_map_div").style("left","5%").style("width","45%"),l["select"]("#choose_circle_div").style("left","50%").style("width","45%"),l["select"]("#OptionPanel").style("height","6vh").style("width","10%"),l["select"]("#OptionContent").remove(),l["select"]("#OptionPanelCursor").attr("class","expand_cursor")}else l["select"]("#OptionPanelText").text(""),l["select"]("#OptionContent").style("display",""),l["select"]("#choose_map_div").style("left","").style("width",""),l["select"]("#choose_circle_div").style("left","").style("width",""),l["select"]("#OptionPanelCursor").attr("class","contract_cursor"),Ne(ot);Be=1-Be}function Fe(t){var e=l["select"]("#table_div"),r=.2*bt,n=.65*Ot;Ot>=bt&&(r=.4*bt,n=.55*Ot),e.style("background-color","rgba(90, 90, 90, 0.6)");var a=.95*r/(t.length+2);l["select"]("#TablePanelCursor").attr("class","contract_cursor"),it==ae&&(l["select"]("#table_div").style("height",(n-.035*p()("#mapPanel").height())/n*100+"%"),l["select"]("#TablePanel").style("width",r/p()("#mapPanel").width()*100+"%").style("height",n/Ot*100+"%").style("left",(kt+.96*bt-r)/p()("#mapPanel").width()*100+"%").style("top",(function(){return""==u?.2*Ot/p()("#mapPanel").height()*100+"%":.25*Ot/p()("#mapPanel").height()*100+"%"})).style("display",""),e.selectAll(".pro_name_back").remove(),e.append("div").attr("class","pro_name_back").style("position","relative").style("left",(function(t,e){return(a*e+.05*a)/r*100+"%"})).style("top",(function(t,e){return"0.2vmin"})).style("width",(function(t,e){return(r-.1*a)/r*100+"%"})).style("height",(function(){return.045*Ot/n*100+"%"})).style("background-color",(function(t,e){return"rgba(256,256,256,0.3)"}))),e.selectAll(".property_name").remove(),e.selectAll(".property_name").data([{chinese_name:"",english_pro:"",english_name:""},{chinese_name:"国家/地区",english_pro:"country",english_name:"Country/<br/>Territory"}].concat(t)).enter().append("div").attr("class","property_name").style("position","absolute").style("left",(function(t,e){return 0==e?.05*a/r*.95*100+"%":1==e?(.5*a+.05*a)/r*.95*100+"%":(a*e+.05*a)/r*.95*100+"%"})).style("width",(function(t,e){return 0==e?a/r*.5*100*.9+"%":1==e?1.6*a/r*100*.9+"%":a/r*100*.9+"%"})).style("top",(function(t,e){return"0.5vh"})).style("height",(function(){return.03*Ot/n*100+"%"})).style("line-height",(function(){return"english"==gt?"1.7vh":"2.1vh"})).html((function(t,e){var r=t.chinese_name;return"english"==gt&&(r=t.english_name),e>1&&(r=r+"<br/>("+q[Z][gt+"_short"]+")"),t.english_pro+"_"+X==ut?1==Y?r+"↓":r+"↑":r})).style("font-size",(function(t,e){return.03*r/Pt*100+"vw"})).style("text-align","center").on("click",(function(t,e){1==t.is_number&&(t.english_pro+"_"+X==ut&&1==Y?(Y=0,At=At.reverse()):(Y=1,ut=t.english_pro+"_"+X,At=At.sort(mr(ut+"_data",it))),1==Ge&&Fe(ot))})).style("cursor","pointer"),e.selectAll("#temp_table_div").remove();var i=e.append("div").attr("id","temp_table_div").style("position","absolute").style("top",.05*Ot/n*100+"%").style("width","100%").style("height",(n-.05*Ot)/n*100+"%").style("overflow-y","auto").style("overflow-x","hidden"),s=.045*n,c=.2*s;i.selectAll(".country_table").remove(),i.selectAll(".country_table").data(At).enter().append("div").attr("class","country_table").attr("id",(function(t,e){return"country_table"+t.chinese_name})).style("position","relative").style("left",(function(t,e){return.05*a/r*100+"%"})).style("margin-bottom",c/n*100+"%").style("width",(function(t,e){return(r-.1*a)/r*100+"%"})).style("height",(function(t){return"english"==gt?t.english_name.length>20?1.7*s/n*100+"%":s/n*100+"%":t.chinese_name.length>7?1.7*s/n*100+"%":s/n*100+"%"})).style("background-color",(function(t,e){return t.chinese_name==o.temp_selected_country?"rgba(60,60,60,0.4)":"rgba(256,256,256,0.3)"})).on("click",(function(t,e){We(t)})).style("cursor","pointer"),t=[{chinese_name:"序号",english_pro:"no"},{chinese_name:"国家/地区",english_pro:"chinese_name"}].concat(t),i.selectAll(".country_table_num").remove();for(var _=function(){var e=t[d].english_pro+"_"+X;d>1&&(e+="_data"),i.selectAll(".country_table").append("div").attr("class","country_table_num country_table"+e).style("position","absolute").style("left",(function(t,e){return 0==d?.05*a/r*100+"%":1==d?(.5*a+.05*a)/r*100+"%":(a*d+.05*a)/r*100+"%"})).style("width",(function(t,e){return 0==d?a/r*.5*.9*100+"%":1==d?1.6*a/r*.9*100+"%":a/r*.9*100+"%"})).html((function(t,r){return 0==d?r+1:1==d?"chinese"==gt?t.chinese_name:t.english_name:Object.prototype.hasOwnProperty.call(t[e],it)?yr(t[e][it]):""})).style("font-size",(function(t,e){return.028*r/p()("#mapPanel").width()*100+"vw"})).style("text-align","center").on("click",(function(t,e){We(t)})).style("cursor","pointer").style("margin-top","0.3vmin")},d=0;d<t.length;d++)_();if(""!=o.temp_selected_country_chinese&&p()("#country_table"+o.temp_selected_country_chinese).length>0){var f=p()("#country_table"+o.temp_selected_country_chinese).offset().top-p()("#temp_table_div").offset().top;p()("#temp_table_div").scrollTop(f)}}var Ge=1;function qe(){var t=.25*bt,e=.65*Ot;Ot>=bt&&(t=.4*bt,e=.55*Ot),1==Ge?(t*=.55,Ot>=bt&&(t=.3*bt),Fe(ot),l["select"]("#table_name").html((function(){return"english"==gt?"Statistics (Expand the table)":"world"==o.selectedMap?"各国统计数据(可展开表格)":"各省统计数据(可展开表格)"})),l["select"]("#table_div").style("display","none"),l["select"]("#TablePanel").style("width",t/p()("#mapPanel").width()*100+"%").style("height","3vmin").style("left",(kt+.96*bt-t)/p()("#mapPanel").width()*100+"%").style("display",""),l["select"]("#TablePanelCursor").attr("class","expand_cursor")):(l["select"]("#table_name").html((function(){return"english"==gt?"world"==o.selectedMap?"Statistics by Country/Territory":"Statistics by Provinces":"world"==o.selectedMap?"各国统计数据(可展开表格)":"各省统计数据(可展开表格)"})),l["select"]("#table_div").style("display",""),l["select"]("#TablePanel").style("width",t/p()("#mapPanel").width()*100+"%").style("height",e/Ot*100+"%").style("left",(kt+.96*bt-t)/p()("#mapPanel").width()*100+"%").style("display",""),l["select"]("#TablePanelCursor").attr("class","contract_cursor"),Fe(ot)),Ge=1-Ge}function We(t){U=1,ar();var e,r,n,a=t.lon_range,i=t.lat_range,s="province";if(1==Object.prototype.hasOwnProperty.call(t,"lon_range")&&1==Object.prototype.hasOwnProperty.call(t,"lat_range")){s="country",t.lon_range,t.lat_range;var c=Ut([(a[0]+a[1])/2,(i[0]+i[1])/2]),p=o.map_lon_range[o.selectedMap]/(a[1]-a[0]),u=o.map_lat_range[o.selectedMap]/(i[1]-i[0]);e=Math.min(p,u),e>20&&(e=20),r=-c[0]*e+.55*bt,n=-c[1]*e+.5*Ot}else{var _=0;1==Object.prototype.hasOwnProperty.call(t,"cp")&&(_=t.cp);var d=Ut(_);e=4.5,r=-d[0]*e+.55*bt,n=-d[1]*e+.65*Ot}if("country"==s){Gt=e,Wt=r,$t=n+Xt,0==Object.prototype.hasOwnProperty.call(t,"english_name")?o.temp_selected_country=t.name:o.temp_selected_country=t.english_name,o.temp_selected_country_chinese=t.chinese_name,te(1e3),Se(),be(),$e(),l["selectAll"](".country_table").style("background-color",(function(t){return t.chinese_name==o.temp_selected_country_chinese?"rgba(60,60,60,0.4)":"rgba(256,256,256,0.3)"}))}}function $e(){l["selectAll"](".overview_info").style("display","none"),l["selectAll"](".selected_country_info").style("display",""),l["selectAll"](".selected_country_name").text((function(){return"chinese"==gt?": "+o.temp_selected_country_chinese:": "+o.temp_selected_country})),l["selectAll"](".selected_country_num").text((function(t){return": "+o.worldDataAll[o.temp_selected_country_chinese][t.english_pro+"_Total_data"][it]})),l["selectAll"](".region").selectAll("path").attr("display",(function(t){return He(t,K)})),l["selectAll"](".country_text").style("display",(function(t){var e=p()("#choose_country_name").prop("checked");return 0==e?"none":He(t,H)})),l["selectAll"](".country_text2").style("display",(function(t){var e=p()("#choose_country_name").prop("checked");return 0==e?"none":He(t,H)})),l["selectAll"](".country_num_text").style("display",(function(t){var e=p()("#choose_detail").prop("checked");return 0==e?"none":He(t,H)})),l["selectAll"](".country_num_text_shadow").style("display",(function(t){var e=p()("#choose_detail").prop("checked");return 0==e?"none":He(t,H)})),l["selectAll"](".num_circle").attr("display",(function(t){var e=p()("#choose_circle").prop("checked");return 0==e?"none":He(t,H)})),l["selectAll"](".links").attr("display",(function(t){return"none"})),Ke()}function He(t,e){return"country"==o.show_region_level?t.properties.chinese_name==o.temp_selected_country_chinese?"":"none":"province"==o.show_region_level?1==Object.prototype.hasOwnProperty.call(t.properties,"temp_country")?t.properties.temp_country==o.temp_selected_country.replaceAll(" ","_")||t.properties.temp_country==o.temp_selected_country.replaceAll(" ","-")||t.properties.temp_country==o.temp_selected_country_chinese?"":"none":t.properties.english_name==o.temp_selected_country&&-1==o.detail_countries_name.indexOf(t.properties.chinese_name)?"":"none":void 0}function Ke(){G={Confirmed_Total:"rgba(194,53,49,0.8)",Recovered_Total:"rgba(58,108,59,0.7)",Dead_Total:"rgba(100,100,100)",GDP_Total:"rgba(194,53,49,0.8)"};var t=ft.overview[ae][h[0].english_name+"_Total_data"];if(""!=o.temp_selected_country_chinese){t=0;for(var e=ne;e<=ae;e=Ar(e,1).replaceAll("/","")){var r=o.worldDataAll[o.temp_selected_country_chinese][h[0].english_name+"_Total_data"][e];r>t&&(t=r)}}var n=.12*Ot,a=l["scaleLinear"]().domain([0,t]).range([n,0]),i=l["axisRight"]().scale(a).ticks(5).tickSize(1*mt);zt.selectAll(".y_axis").remove(),zt.append("g").attr("class","y_axis").call(i).attr("transform","translate("+ie+","+(se-n)+")").attr("font-size","0.8vmin").attr("stroke-width","0.1vmin"),zt.selectAll(".y_axis").selectAll("text").style("dx","3vw");var s=l["line"]().x((function(t,e){return ce(e)})).y((function(t){return a(t)})),c=[];zt.selectAll(".pro_lines").remove(),zt.selectAll(".line_chart_point").remove(),zt.selectAll(".line_chart_pro").remove();var p=function(){var t=ot[u].english_pro+"_"+X+"_data";if(c=[],0==ot[u].is_unit_person)return"continue";for(_=ne;_<=ae;_=Ar(_,1).replaceAll("/",""))""!=o.temp_selected_country_chinese?0==Object.prototype.hasOwnProperty.call(o.worldDataAll,o.temp_selected_country_chinese)||0==Object.prototype.hasOwnProperty.call(o.worldDataAll[o.temp_selected_country_chinese],t)||0==Object.prototype.hasOwnProperty.call(o.worldDataAll[o.temp_selected_country_chinese][t],_)?c.push(0):c.push(o.worldDataAll[o.temp_selected_country_chinese][t][_]):0==Object.prototype.hasOwnProperty.call(ft.overview,_)?c.push(0):c.push(ft.overview[_][t]);zt.append("path").attr("class","pro_lines").attr("d",s(c)).attr("stroke",(function(e){return G[t.split("_data")[0]]})).attr("fill","none").attr("transform",(function(){return"translate("+ie+","+(se-n)+")"})),zt.selectAll(".line_chart_point").data(c).enter().append("circle").attr("class","line_chart_point").attr("cx",(function(t,e){return ce(e)})).attr("cy",(function(t,e){return a(t)})).attr("transform",(function(){return"translate("+ie+","+(se-n)+")"})).attr("r",.001*Ot).attr("fill",(function(e){return G[t.split("_data")[0]]})),zt.selectAll(".line_chart_pro"+t).data([ot[u]]).enter().append("text").attr("class","line_chart_pro").attr("x",ie+oe).attr("y",se-n+a(c[c.length-1])).text((function(t){return t.chinese_name})).attr("font-size","1.35vmin").attr("fill",(function(t){return G[t.english_pro]})).attr("text-anchor","end")};for(var u in ot){var _;p()}}var Ye=1;function Je(){var t=.35*bt;Ot>=bt&&(t=.5*bt);var e=.16*Ot,r=.67*Ot;1==Ye?(t*=.2,l["select"]("#line_chart_div").style("display","none"),l["select"]("#LineChartPanel").style("width",t/p()("#mapPanel").width()*100+"%").style("height","3vmin").style("left",(kt+.98*bt-t)/p()("#mapPanel").width()*100+"%").style("top",100*((r+e)/p()("#mapPanel").height()-.03)+"%").style("display",""),l["select"]("#LineChartCursor").attr("class","expand_cursor")):(l["select"]("#line_chart_div").style("display",""),l["select"]("#LineChartPanel").style("width",t/p()("#mapPanel").width()*100+"%").style("height",e/p()("#mapPanel").height()*100+"%").style("left",(kt+.98*bt-t)/p()("#mapPanel").width()*100+"%").style("top",r/p()("#mapPanel").height()*100+"%").style("display",""),l["select"]("#LineChartCursor").attr("class","contract_cursor")),Ye=1-Ye}function Xe(t){l["selectAll"](".country_num_text").style("opacity",0),l["selectAll"](".region").selectAll("path").transition().duration(500).attr("fill",(function(e){if(0!=Object.prototype.hasOwnProperty.call(e.properties,K)){var r=er(e,ne,it);return r<=w[t.id].range[1]&&r>w[t.id].range[0]?Mt(t.id):void 0}})),l["selectAll"](".links").style("stroke-width",(function(e,r){var n=0,a=parseInt(e[H]);1==_t&&(a=ft.features[e.target.id].properties[H][it.toString()]);var l=a-n;if(l<=w[t.id].range[1]&&l>w[t.id].range[0]){if(e.main_data<=it)return;return 0}return 0})).attr("opacity",(function(){return N})),l["selectAll"](".country_num_text").style("opacity",(function(e,r){if(0==Object.prototype.hasOwnProperty.call(e.properties,K))return"";var n,a=0;if(1==_t){var l=e.properties[K][it.toString()];n=l-a}else n=e.properties.stage;return n<=w[t.id].range[1]&&n>w[t.id].range[0]?1:0})).attr("display",(function(t){return ye(t)})),l["selectAll"](".country_text").attr("display",(function(e,r){if("none"==ye(e))return"none";if(0==Object.prototype.hasOwnProperty.call(e.properties,H))return"none";var n,a=0;if(1==_t){var l=e.properties[K][it.toString()];n=l-a}else n=e.properties[K]>0?e.properties[K]:e.properties.stage;return n<=w[t.id].range[1]&&n>w[t.id].range[0]?1:"none"})),l["selectAll"](".country_text2").attr("display",(function(e,r){if("none"==ye(e))return"none";if(0==Object.prototype.hasOwnProperty.call(e.properties,H))return"none";var n,a=0;if(1==_t){var l=e.properties[K][it.toString()];n=l-a}else n=e.properties.stage;return n<=w[t.id].range[1]&&n>w[t.id].range[0]?1:"none"})),l["selectAll"](".num_circle").attr("r",(function(e,r){if(0==Object.prototype.hasOwnProperty.call(e.properties,K))return 0;if("none"==ye(e))return 0;var n,a=0,l=0;if(1==_t){var o=e.properties[K][it.toString()];l=e.properties[H][it.toString()],n=o-a}else n=e.properties.stage;return n<=w[t.id].range[1]&&n>w[t.id].range[0]?st(l):0})),l["selectAll"](".mycircle").attr("r",(function(e,r){var n=0,a=parseInt(e.main_data);1==_t&&(a=ft.features[e.target.id].properties[H][it.toString()]);var l=a-n;return l<=w[t.id].range[1]&&l>w[t.id].range[0]&&e.main_data<it?10*mt:0})).style("fill-opacity",(function(e,r){return e.stage==t.id?.8:.1})).style("opacity",(function(){return 1}))}function Qe(t){return rr(ne,it),!0}function Ze(t,e){for(var r=0;r<yt.length;r++)if(1==_t){if(yt[r].source.name==t.name&&yt[r].target.name==e.name&&yt[r].date<=it)return 1;if(yt[r].source.name==e.name&&yt[r].target.name==t.name&&yt[r].date<=it)return 1}else{if(yt[r].source.name==t.name&&yt[r].target.name==e.name)return 1;if(yt[r].source.name==e.name&&yt[r].target.name==t.name)return 1}return 0}function tr(){if(E=0,L=1,I<2)I+=1;else{if(null==l["event"].selection)return l["selectAll"](".worlds").style("fill",(function(t,e){return"null"==t.properties.stage?"rgb(160,160,160)":Mt(t.properties.stage)})),l["selectAll"](".range_text").style("fill","none"),l["selectAll"](".country_text").style("fill-opacity",(function(t){return.9})),l["selectAll"](".country_text2").style("fill-opacity",(function(t){return.9})),l["selectAll"](".links").style("stroke-width",(function(t){})),void l["selectAll"](".mycircle").attr("r",(function(t,e){return 6*mt})).style("fill-opacity",(function(t,e){return.3}));var t,e,r=l["event"].selection,n=r[0]-se,a=r[1]-se;1==_t?(t=parseInt(Ar(ne,parseInt(n*(ae-ne)/oe)).replaceAll("/","")),e=parseInt(Ar(ne,parseInt(a*(ae-ne)/oe)).replaceAll("/",""))):(t=ne+parseInt(n*(ae-ne)/oe),e=ne+parseInt(a*(ae-ne)/oe)),rr(t,e)}}function er(t,e,r){if(0==Object.prototype.hasOwnProperty.call(t.properties,H))return 0;var n=0;if(e!=ne){var a=Ar(ne,Sr(ne,parseInt(e))-1).replaceAll("/","");n=t.properties[H][a]}var l=t.properties[H][r.toString()];return isNaN(l-n)||l-n==0?0:l-n}function rr(t,e){l["selectAll"](".point_text").text((function(){return me(it)})),"nCoV"==$&&(l["selectAll"](".overview_country_num").text((function(){var t=0;return 0!=Object.prototype.hasOwnProperty.call(ft.overview,e.toString())&&(t=ft.overview[e.toString()].country_num),": "+t})),l["selectAll"](".overview_num").text((function(t,r){var n=0;return 0!=Object.prototype.hasOwnProperty.call(ft.overview,e.toString())&&(n=ft.overview[e.toString()][t.english_pro+"_Total_data"]),": "+vr(n)}))),""!=o.temp_selected_country_chinese&&l["selectAll"](".selected_country_num").text((function(t){return": "+o.worldDataAll[o.temp_selected_country_chinese][t.english_pro+"_Total_data"][it]})),At=At.sort(mr(ut+"_data",it)),1==Ge&&Fe(ot),l["selectAll"](".country_num_text").text((function(r){if(0==Object.prototype.hasOwnProperty.call(r.properties,H))return"";if(0==le){var n=0;if(t!=ne){var a=Ar(ne,Sr(ne,parseInt(t))-1).replaceAll("/","");n=r.properties[H][a]}var l=r.properties[H][e.toString()],o=l-n;return isNaN(l-n)||l-n==0?"":hr(o)}})).style("opacity",1).attr("display",(function(t){return fe(t)})),l["selectAll"](".country_num_text_shadow").text((function(r){if(0==Object.prototype.hasOwnProperty.call(r.properties,H))return"";if(0==le){var n=0;if(t!=ne){var a=Ar(ne,Sr(ne,parseInt(t))-1).replaceAll("/","");n=r.properties[H][a]}var l=r.properties[H][e.toString()],o=l-n;return isNaN(l-n)||l-n==0?"":hr(o)}})).style("opacity",.6).attr("display",(function(t){return fe(t)})),l["select"](".islands").selectAll("path").attr("fill",(function(){if(0==le){var r=0,n=re;if(parseInt(t)!=ne){var a=Ar(ne,Sr(ne,parseInt(t))-1).replaceAll("/","");r=n[K][a]}for(var l=n[K][e.toString()],o=l-r,i=0;i<w.length;i++)if(o<=w[i].range[1]&&o>w[i].range[0])return Mt(i);return"rgb(160,160,160)"}return"rgb(160,160,160)"})),l["selectAll"](".region").selectAll("path").attr("fill",(function(r,n){return Pe(r,t,e)})).attr("opacity",1).style("display",(function(t){return ye(t)})),"province"==o.show_region_level?(l["selectAll"](".region").attr("filter",""),l["selectAll"](".world").attr("filter","url(#drop-map-shadow)")):l["selectAll"](".region").attr("filter",""),l["selectAll"](".country_text").attr("display",(function(t){return"none"==fe(t)?"none":void 0})).attr("opacity",(function(r){return 0==Object.prototype.hasOwnProperty.call(r.properties,H)?.3:er(r,t,e)>0?1:.3})),l["selectAll"](".country_text2").attr("display",(function(t){return"none"==fe(t)?"none":void 0})).attr("opacity",(function(r){return 0==Object.prototype.hasOwnProperty.call(r.properties,H)?.3:er(r,t,e)>0?1:.3})),l["selectAll"](".range_text").text((function(){return 1==D?xr(e):1==_t?xr(t)+"-"+xr(e):xr(parseInt(t))+"-"+xr(parseInt(e))})).attr("opacity",1),l["selectAll"](".links").style("stroke-width",(function(r){if(0==le){var n=r.main_data;return n>=t&&n<=e?Ft:0}var a=r.main_data;return a>=t&&a<=e?void 0:0})).attr("opacity",(function(t){return N})),l["selectAll"](".num_circle").attr("r",(function(r,n){if(0==Object.prototype.hasOwnProperty.call(r.properties,H))return 0;if(0==le){var a=0;if(t!=ne){var l=Ar(ne,Sr(ne,parseInt(t))-1).replaceAll("/","");a=r.properties[H][l]}var o=r.properties[H][e.toString()];return isNaN(o-a)||o-a==0?0:st(o-a)}})).attr("opacity",1).attr("display",(function(t){return he(t)})),l["selectAll"](".mycircle").attr("r",(function(r,n){if(0==le){var a=r.main_data;return a>=t&&a<=e?5*mt:0}var l=r.main_data;return l<e&&l>t?6*mt:0})).style("fill-opacity",(function(r,n){if(0==le)return N;var a=r[H];return a<e&&a>t?.3:0})).style("opacity",(function(t){return N})),""!=o.temp_selected_country_chinese&&$e()}function nr(t){l["select"]("#mapPanel").selectAll(".info_tooltip").remove();l["select"]("#mapPanel").append("div").attr("class","info_tooltip").style("position","absolute").style("left",(function(){var e=Ut(t.cp)[0];return e=e*Gt+Wt+10*mt,e/p()("#mapPanel").width()*100+"%"})).style("bottom",(function(){var e=Ut(t.cp)[1];return e=e*Gt+$t,100*(1-e/p()("#mapPanel").height())+"%"})).style("opacity",1).html((function(){var e="";"chinese"==gt?(e+=t.chinese_name+"<br/>",e+="( "+q[Z].chinese+" )"):(e+=t.name+"<br/>",e+="( "+q[Z].english+" )"),e+="<br/>";for(var r=0;r<ot.length;r++)if(0!=Object.prototype.hasOwnProperty.call(t[ot[r].english_pro+"_"+X+"_data"],it.toString())){e+=ot[r][gt+"_name"];var n=t[ot[r].english_pro+"_"+X+"_data"][it.toString()];e+=": "+yr(n),e+="<br/>"}return e}));U=0;t.cp;l["selectAll"](".region").selectAll("path").attr("fill",(function(e){if(0!=Object.prototype.hasOwnProperty.call(e.properties,K))return 1==D&&0==t[K][it.toString()]?"rgb(160,160,160)":1==Ze(e.properties,t)||e.properties.name==t.name?Pe(e,ne,it):"rgb(160,160,160)"})),l["selectAll"](".country_text").attr("opacity",(function(e,r){return 1==Ze(e.properties,t)?1:0})),l["selectAll"](".country_text2").attr("opacity",(function(e,r){return 1==Ze(e.properties,t)?1:0})),l["selectAll"](".country_num_text").style("opacity",0),l["selectAll"](".country_num_text_shadow").style("opacity",0),l["selectAll"](".links").style("stroke-width",(function(e,r){return(e.source.name==t.name||e.target.name==t.name)&&e.main_data<=it?void 0:0})).attr("opacity",N),l["selectAll"](".num_circle").attr("opacity",(function(e,r){return e.properties.name==t.name?1:0})),l["selectAll"](".mycircle").attr("r",(function(e,r){return e.source.name==t.name||e.target.name==t.name?10*mt:0})).style("fill-opacity",(function(e,r){return e.source.name==t.name||e.target.name==t.name?1:0})).style("opacity",(function(t){return 1==D&&t.main_data>it?0:.8}))}function ar(){return U=1,l["select"]("#mapPanel").selectAll(".info_tooltip").remove(),l["selectAll"](".mouseover_text_1").text(""),l["selectAll"](".mouseover_text_2").text(""),rr(ne,it),!0}function lr(t,e){var r=t,n=50;l["selectAll"](".button_rect").attr("opacity",0),l["selectAll"](".button_stop").attr("opacity",1),z=l["timer"]((function(){if(l["selectAll"](".button_stop").attr("fill-opacity",1),1==dt||parseInt(t)>e||1==L)return console.log("end"),L=1,E=1-E,l["selectAll"](".button_rect").attr("opacity",1),l["selectAll"](".button_stop").attr("opacity",0),z.stop(),!0;it=parseInt(t),it==ne&&(l["selectAll"](".mycircle").attr("r",(function(t,e){return 0})),l["selectAll"](".links").style("stroke-width",(function(t,e){return 0}))),1==E&&(1==D&&(l["selectAll"](".point_text").text((function(){return me(it)})),l["selectAll"](".slide_rect").attr("x",(function(t,e){return ie+oe*Sr(ne,it)/Sr(ne,ae)-8*mt})),l["selectAll"](".overview_country_num").text((function(){var e=0;return 0!=Object.prototype.hasOwnProperty.call(ft.overview,parseInt(t).toString())&&(e=ft.overview[parseInt(t).toString()].country_num),": "+e})),l["selectAll"](".overview_num").text((function(e,r){var n=0;return 0!=Object.prototype.hasOwnProperty.call(ft.overview,parseInt(t).toString())&&(n=ft.overview[parseInt(t).toString()][e.english_pro+"_"+X+"_data"]),": "+vr(n)})),""!=o.temp_selected_country_chinese&&l["selectAll"](".selected_country_num").text((function(t){return": "+o.worldDataAll[o.temp_selected_country_chinese][t.english_pro+"_Total_data"][it]}))),l["selectAll"](".num_circle").attr("r",(function(e,r){if(0==Object.prototype.hasOwnProperty.call(e.properties,H))return 0;if(0==le){var n=0,a=e.properties[H][parseInt(t).toString()];return isNaN(a-n)||a-n==0?0:st(a-n)}})),l["selectAll"](".mycircle").transition().duration(n).attr("r",(function(e,r){return e.main_data<t?6*mt:0})).attr("fill-opacity",(function(e,r){return e.main_data<t?1:0})),1==Ge&&it>r&&(r=it,At=At.sort(mr(ut+"_data",it)),Fe(ot)),l["selectAll"](".links").transition().duration(n/2).style("stroke-width",(function(e,r){return e.main_data<parseInt(t)?void 0:e.main_data==parseInt(t)?Gt<=1?"0.12%":"0.11%":0})).attr("opacity",(function(e){return it==ae?.8:e.main_data<parseInt(t)?.3:e.main_data==parseInt(t)?1:0})),l["selectAll"](".region").selectAll("path").transition().duration(n).attr("fill",(function(e,r){if(0==Object.prototype.hasOwnProperty.call(e.properties,K))return 0;if(1==e.properties.hasData){if(0==le){for(var n=e.properties[K][parseInt(t).toString()],a=0;a<w.length;a++)if(n<=w[a].range[1]&&n>w[a].range[0])return Mt(a);return}if(5==e.properties[K].length){var l=parseInt(e.properties[K].substr(0,4));if(l<t)return Mt(e.properties.stage)}return e.properties[K]<t?Mt(e.properties.stage):"rgb(160,160,160)"}})),l["select"](".islands").selectAll("path").attr("fill",(function(){if(0==le){for(var e=re,r=e[K][parseInt(t).toString()],n=0;n<w.length;n++)if(r<=w[n].range[1]&&r>w[n].range[0])return Mt(n);return"rgb(160,160,160)"}return"rgb(160,160,160)"})),l["selectAll"](".country_text").transition().duration(n).attr("display",(function(t){return"none"==fe(t)?"none":""})).attr("opacity",(function(e){return 0==Object.prototype.hasOwnProperty.call(e.properties,K)?.3:er(e,ne,parseInt(t))>0?1:.3})),l["selectAll"](".country_text2").transition().duration(n).attr("display",(function(t){return"none"==fe(t)?"none":""})).attr("opacity",(function(e){return 0==Object.prototype.hasOwnProperty.call(e.properties,K)?.3:er(e,ne,parseInt(t))>0?1:.3})),l["selectAll"](".country_num_text").transition().duration(n).text((function(e){if(0==Object.prototype.hasOwnProperty.call(e.properties,H))return"";if(0==le){var r=e.properties[H][parseInt(t).toString()];return isNaN(r)||0==r?"":hr(r)}})).attr("display",(function(t){return fe(t)})),l["selectAll"](".country_num_text_shadow").transition().duration(n).text((function(e){if(0==Object.prototype.hasOwnProperty.call(e.properties,H))return"";if(0==le){var r=e.properties[H][parseInt(t).toString()];return isNaN(r)||0==r?"":hr(r)}})).attr("display",(function(t){return fe(t)}))),l["selectAll"](".range_text").transition().duration(n).text(xr(parseInt(t))).style("opacity",1);var a=ae-ne;0==E?(l["selectAll"](".button_stop").attr("fill-opacity",0),t+=0):0==le?(t<20200110?(t+=.2,t+.2>parseInt(t)+1&&(t=parseInt(Ar(parseInt(t),1).replaceAll("/","")))):t+=.05,t+.05>parseInt(t)+1&&(t=parseInt(Ar(parseInt(t),1).replaceAll("/","")))):t+=t<ne+.1*a?.1:t<ne+.3*a?3:t<ne+.4*a?.1:t<ne+.6*a?.03:t<ne+.8*a?.1:.03}))}function or(t){var e=Ut([t.source.x,t.source.y]),r=Ut([t.target.x,t.target.y]),n=10*mt,a=1*mt;e[0]>r[0]&&(a=-1),e[0],r[0];var l=8/9*e[0]+r[0]/9,o=1/9*e[1]+8*r[1]/9;return"Unkown"==t.source.name&&(o=8/9*e[1]+1*r[1]/9,l=.5*e[0]+r[0]/2),"United worlds of America"==t.target.name&&(o=8/9*e[1]+1*r[1]/9-.06*Ot,l=.5*e[0]+r[0]/2),"M"+e[0]+" "+e[1]+"Q"+l+" "+o+" "+(r[0]-a*n)+" "+r[1]}function ir(t){var e="2020",r=t.split("月")[0],n=t.split("月")[1].split("日")[0];return e+=r<10?"0"+r:r,e+=n<10?"0"+n:n,e}function sr(t){""==t&&(t=p()("#choose_line").prop("checked")),1==t&&1==p()("#choose_line").prop("checked")&&"Confirmed_Total_data"==K?(l["selectAll"](".links").attr("display",""),l["selectAll"](".mycircle").attr("display",""),yt=vt):(l["selectAll"](".links").attr("display","none"),l["selectAll"](".mycircle").attr("display","none"),yt={}),""!=o.temp_selected_country_chinese&&$e()}function cr(){var t=p()("#choose_detail").prop("checked");1==t?(l["selectAll"](".country_num_text").style("display",""),l["selectAll"](".country_num_text_shadow").style("display","")):(l["selectAll"](".country_num_text").style("display","none"),l["selectAll"](".country_num_text_shadow").style("display","none")),""!=o.temp_selected_country_chinese&&$e()}function pr(){var t=p()("#choose_country_name").prop("checked");1==t?(l["selectAll"](".country_text").style("display",""),l["selectAll"](".country_text2").style("display","")):(l["selectAll"](".country_text").style("display","none"),l["selectAll"](".country_text2").style("display","none")),""!=o.temp_selected_country_chinese&&$e()}function ur(){var t=p()("#choose_map").prop("checked");1==t?l["selectAll"](".region").selectAll("path").style("fill",""):l["selectAll"](".region").selectAll("path").style("fill","rgba(160,160,160,0.6)")}function _r(){var t=p()("#choose_circle").prop("checked");1==t?(l["selectAll"](".num_circle").attr("display",(function(t){if("none"==he(t))return"none"})),l["selectAll"](".circle_line").style("display",""),l["selectAll"](".circle_text").style("display",""),l["selectAll"](".explain_circle").style("display",""),l["selectAll"](".circle_pro_explain").style("display","")):(l["selectAll"](".num_circle").attr("display","none"),l["selectAll"](".circle_line").style("display","none"),l["selectAll"](".circle_text").style("display","none"),l["selectAll"](".explain_circle").style("display","none"),l["selectAll"](".circle_pro_explain").style("display","none")),""!=o.temp_selected_country_chinese&&$e()}function dr(){gt="chinese",p()(".titleText").text("北京大学地图可视化工具集"),0==Be&&l["select"]("#OptionPanelText").text("展开切换数据类型"),l["select"]("#top-text").text(m),l["selectAll"](".pmpOption").text("占人口比"),l["selectAll"](".TotalOption").text("累计值"),l["selectAll"](".no_data_text").text("无数据"),l["select"]("#select_region_level_title").text("地图粒度"),l["select"]("#country_level").text((function(){return"world"==o.selectedMap?"国家级":"省级"})),l["select"]("#province_level").text((function(){return"world"==o.selectedMap?"省级":"市级"})),l["select"]("#select_region_level_text").text("*省级只收集了能找到的确诊数据，其总数和国家级可能不匹配"),l["selectAll"](".map_pro_tyeps").html((function(t){return t["chinese"]})),l["selectAll"](".circle_pro_tyeps").html((function(t){return t["chinese"]})),l["selectAll"](".map_pro_type_div").html((function(){return q[Q]["chinese_short"]})),l["selectAll"](".circle_pro_type_div").html((function(){return q[Z]["chinese_short"]})),l["selectAll"](".property_title_text").text("统计类型"),l["selectAll"](".map_pro_explain").text((function(){return ot[tt].chinese_name+" ("+W[J].chinese+")"})),l["selectAll"](".circle_pro_explain").text((function(){return ot[et].chinese_name+" ("+W[X].chinese+")"})),l["selectAll"](".select_PMP_div").html((function(t){return t.chinese_name})),l["selectAll"](".property_name_text").html((function(t){return t.chinese_name+""+t.chinese_unit})),l["select"]("#choose_map_text").text("填色地图"),l["select"]("#option_name").text("显示方案选择"),1==Ge&&Fe(ot),l["selectAll"](".line_chart_pro").text((function(t){return t.chinese_name})),l["select"]("#line_chart_name").html("折线图"),l["select"]("#choose_circle_text").html("圆圈"),l["select"]("#table_name").html((function(){return 1==Ge?"world"==o.selectedMap?"各国统计数据":"各省统计数据":"world"==o.selectedMap?"各国统计数据(可展开表格)":"各省统计数据(可展开表格)"})),l["selectAll"]("#choose_line_text").text((function(t){return""==M?"显示连线":M})),l["selectAll"]("#choose_detail_text").text((function(t){return"显示具体数字 (和圆对应)"})),l["selectAll"]("#choose_country_name_text").text((function(t){return"显示国家名称"})),l["selectAll"]("#choose_property").text((function(t){return"选择属性"})),l["selectAll"](".properties_div").html((function(t){return t.chinese_name})).style("font-size","1.4vmin"),l["selectAll"](".unkown_text").text((function(t){return t.properties.chinese_name})),l["select"](".explain_panel").html(V+"<br/>(* 国界仅为参考，不作为划界依据)"),l["selectAll"](".hint_text2").text("(* 国界仅为参考，不作为划界依据)"),l["selectAll"](".zoom_icon_text").text((function(t){return t.loc_name.split(" ")[0]})).attr("dy",(function(t,e){var r=.026*bt;Ot>=bt&&(r=.04*bt),"world"!=o.selectedMap&&(r*=1.3);var n=.6*r;return t.loc_name.split(" ").length>1&&(n=.45*r),n})),l["selectAll"](".zoom_icon_text2").text((function(t){return t.loc_name.split(" ")[1]})).attr("dy",(function(t,e){var r=.026*bt;Ot>=bt&&(r=.04*bt),"world"!=o.selectedMap&&(r*=1.3);var n=.6*r;return t.loc_name.split(" ").length>1&&(n=.7*r),n})),l["select"]("#web_title").text(m),l["selectAll"](".hint_text").text((function(){return V})),l["selectAll"](".country_text").text((function(t){return t.properties.chinese_name})),l["selectAll"](".country_text2").text((function(t){return""})),l["selectAll"](".mouseover_text_1").text((function(t){return""})),l["selectAll"](".mouseover_text_2").text((function(t){return""})),l["selectAll"](".country_num_text").attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[1]+o.country_text_size}})),l["selectAll"](".country_num_text_shadow").attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return e[1]+o.country_text_size}})),l["selectAll"](".point_text").text((function(){return me(it)})),l["selectAll"](".source1").text("数据来源: "+O),l["selectAll"](".source2").text("地图数据来源: "+k),l["selectAll"](".shadow_title").text(m),l["selectAll"](".title").text(m),l["selectAll"](".subtitle").text(g),1==D&&(l["selectAll"](".overview_country_num").attr("dx",107*Dt*1.5),l["selectAll"](".overview_country").text((function(){return 0!=Object.prototype.hasOwnProperty.call(ft.overview,it.toString())&&ft.overview[it.toString()].country_num,"nCoV"==o.selectedDataSet?"world"==o.selectedMap?"确诊国家/地区":"确诊省份":"world"==o.selectedMap?"统计国家/地区":"统计省份"})),l["selectAll"](".overview_name").text((function(t,e){return 0!=Object.prototype.hasOwnProperty.call(ft.overview,it.toString())&&ft.overview[it.toString()][t.english_pro+"_Total_data"],"nCoV"==o.selectedDataSet?"累计"+t.chinese_name+t.chinese_unit:t.chinese_name+t.chinese_unit})),l["selectAll"](".overview_num").attr("x",ie+107*Dt*1.5),l["selectAll"](".selected_country").text((function(){return"world"==o.selectedMap?"选中国家":"选中省份"})),l["selectAll"](".selected_country_name").text(": "+o.temp_selected_country_chinese).attr("x",ie+107*Dt*1.6),l["selectAll"](".selected_country_pro").text((function(t,e){return 0!=Object.prototype.hasOwnProperty.call(ft.overview,it.toString())&&ft.overview[it.toString()][t.english_pro+"_Total_data"],"nCoV"==o.selectedDataSet?"累计"+t.chinese_name+t.chinese_unit:t.chinese_name+t.chinese_unit})),l["selectAll"](".selected_country_num").attr("x",ie+107*Dt*1.6))}function fr(){gt="english",l["select"]("#top-text").text(v),p()(".titleText").text("Map Visualization Toolkit"),0==Be&&l["select"]("#OptionPanelText").text("Expand to change statistical type"),l["select"]("#select_region_level_title").text("Map Level"),l["select"]("#country_level").text((function(){return"world"==o.selectedMap?"Countries":"Provinces"})),l["select"]("#province_level").text((function(){return"world"==o.selectedMap?"Provinces":"Cities"})),l["select"]("#select_region_level_text").text("*For province level, we only collected comfirmed cases that we could find, so the sum may not match the country level."),l["selectAll"](".map_pro_tyeps").html((function(t){return t["english"]})),l["selectAll"](".circle_pro_tyeps").html((function(t){return t["english"]})),l["selectAll"](".map_pro_type_div").html((function(){return q[Q]["english_short"]})),l["selectAll"](".circle_pro_type_div").html((function(){return q[Z]["english_short"]})),l["selectAll"](".pmpOption").text("Per Population"),l["selectAll"](".TotalOption").text("Total Value"),l["selectAll"](".no_data_text").text("No Data"),l["selectAll"](".map_pro_explain").text((function(){return ot[tt].english_pro+" ("+W[J].english+")"})),l["selectAll"](".circle_pro_explain").text((function(){return ot[et].english_pro+" ("+W[X].english+")"})),l["selectAll"](".property_title_text").text("Statistical Type"),l["selectAll"](".select_PMP_div").html((function(t){return t.english_name})),l["selectAll"](".property_name_text").html((function(t){return t.english_name+" "+t.english_unit})),l["select"]("#choose_map_text").text("Map Color"),l["select"]("#option_name").text("Display Option"),1==Ge&&Fe(ot),l["selectAll"](".line_chart_pro").text((function(t){return t.english_pro})),l["select"]("#table_name").html((function(){return 1==Ge?"world"==o.selectedMap?"Statistics by Country/Territory":"Statistics by Provinces":"Statistics (Expand the table)"})),l["select"]("#choose_circle_text").html("Circle"),l["select"]("#line_chart_name").html("Line chart"),l["selectAll"]("#choose_line_text").text((function(t){return""==T?"Show links":T})),l["selectAll"]("#choose_detail_text").text((function(t){return"Show Number (correspond to circle)"})),l["selectAll"]("#choose_country_name_text").text((function(t){return"Show Country Name"})),l["selectAll"]("#choose_property").text((function(t){return"Choose properties"})),l["selectAll"](".properties_div").html((function(t){return t.english_name})).style("font-size","1.25vmin"),l["selectAll"](".unkown_text").text((function(t){return t.properties.name})),l["select"](".explain_panel").html(F+"<br/>(* Boundaries are just for reference, not as a basis for demarcation)"),l["selectAll"](".zoom_icon_text").text((function(t){return t.id.split(" ")[0]})).attr("dy",(function(t,e){var r=.026*bt;Ot>=bt&&(r=.04*bt),"world"!=o.selectedMap&&(r*=1.3);var n=.6*r;return t.id.split(" ").length>1&&(n=.45*r),n})),l["selectAll"](".zoom_icon_text2").text((function(t){return t.id.split(" ")[1]})).attr("dy",(function(t,e){var r=.026*bt;Ot>=bt&&(r=.04*bt),"world"!=o.selectedMap&&(r*=1.3);var n=.6*r;return t.id.split(" ").length>1&&(n=.7*r),n})),l["select"]("#web_title").text(v),l["selectAll"](".hint_text").text((function(){return F})),l["selectAll"](".country_text").text((function(t){var e=t.properties.name;return 1==Object.prototype.hasOwnProperty.call(t.properties,"english_name")&&(e=t.properties.english_name),e.split(" ")[0]})),l["selectAll"](".country_text2").text((function(t){return 3==t.properties.name.split(" ").length?t.properties.name.split(" ")[1]+" "+t.properties.name.split(" ")[2]:t.properties.name.split(" ")[1]})),l["selectAll"](".country_num_text").attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return t.properties.name.split(" ").length<2?e[1]+o.country_text_size:e[1]+2*o.country_text_size}})),l["selectAll"](".country_num_text_shadow").attr("y",(function(t){if(0!=t.properties.cp&&""!=t.id){var e=Ut([t.properties.cp[0],t.properties.cp[1]]);return t.properties.name.split(" ").length<2?e[1]+o.country_text_size:e[1]+2*o.country_text_size}})),l["selectAll"](".point_text").text((function(){return me(it)})),l["selectAll"](".source1").text("Data Source: "+P),l["selectAll"](".source2").text("Map Source: "+k),l["selectAll"](".shadow_title").text(v),l["selectAll"](".title").text(v),l["selectAll"](".subtitle").text(x),1==D&&(l["selectAll"](".overview_country").text((function(){return 0!=Object.prototype.hasOwnProperty.call(ft.overview,it.toString())&&ft.overview[it.toString()].country_num,"nCoV"==o.selectedDataSet?"world"==o.selectedMap?"Countries/Territories with Cases":"Provinces/Districts with Cases":"world"==o.selectedMap?"Countries/Territories with Data":"Provinces/Districts with Data"})),l["selectAll"](".overview_country_num").attr("dx",130*Dt*2.1),l["selectAll"](".overview_name").text((function(t,e){return 0!=Object.prototype.hasOwnProperty.call(ft.overview,it.toString())&&ft.overview[it.toString()][t.english_pro+"_Total_data"],"Total "+t.english_pro+" "+t.english_unit})),l["selectAll"](".overview_num").attr("x",ie+130*Dt*1.6),l["selectAll"](".selected_country").text((function(){return"world"==o.selectedMap?"Selected Country":"Selected Province"})),l["selectAll"](".selected_country_name").text(": "+o.temp_selected_country).attr("x",ie+130*Dt*1.6),l["selectAll"](".selected_country_pro").text((function(t,e){return 0!=Object.prototype.hasOwnProperty.call(ft.overview,it.toString())&&ft.overview[it.toString()][t.english_pro+"_Total_data"],"Total "+t.english_pro+" "+t[gt+"_unit"]})),l["selectAll"](".selected_country_num").attr("x",ie+130*Dt*1.6))}function hr(t){if(t<1e-4)return"";var e=parseInt(t);return t-e>0?"Per KM2"==X?t<1e-4?"":t.toFixed(4):1==rt?t.toFixed(2)+"%":t.toFixed(2):1==rt?t+"%":t}function yr(t){var e=parseInt(t);if(t<1e-6)return t.toFixed(7).replace(/\.?0+$/,"");if(t-e>0){if("Per KM2"==X){String(t);return t.toFixed(7)}return 1==rt?t.toFixed(2)+"%":t.toFixed(2)}return 1==rt?t+"%":vr(t)}function vr(t){var e=t-parseInt(t);e>0&&(e=e.toFixed(2)),t=parseInt(t),t=t.toString().split("").reverse();for(var r=[],n=0,a=t.length;n<a;n++)n%3==0&&0!=n&&r.push(","),r.push(t[n]);return r.reverse(),e=e.toString(),0==e?e="":-1!=e.indexOf(".")&&(e="."+e.split(".")[1]),r.join("")+e}function mr(t,e){return function(r,n){var a=r[t][e],l=n[t][e];return isNaN(a)&&(a=0),isNaN(l)&&(l=0),l-a}}function gr(t){for(var e=["自治","州","林区","地区","盟","区","市","县","自治县","土家族","苗族","布依族","傣族","哈尼族","哈萨克","回族","朝鲜族"],r=0;r<e.length;r++)t=t.split(e[r])[0];return t}function xr(t){if("year"==R)return t;if(1==le)return t;t=t.toString();var e="";return e+=t.substr(0,4)+"/",e+=t.substr(4,2)+"/",e+=t.substr(6,2),e}function wr(t){if("year"==R)return t;if("month"==R)return t;if(-1!=t.indexOf("月"))return ir(t);var e=t.split(" ")[0],r=(t.split(" ")[1],e.split("/")[0]),n=parseInt(e.split("/")[1]);n<10&&(n="0"+n);var a=parseInt(e.split("/")[2]);return a<10&&(a="0"+a),r+n+a}function Ar(t,e){var r=[0,31,28,31,30,31,30,31,31,30,31,30,31];if(t=parseInt(t),e=parseInt(e),"year"==R)return(t+e).toString();if("month"==R){var n=Math.floor(t/100),a=t%100;return a=(a+e)%12,n+=parseInt((a+e)/12),a<10&&(a="0"+a),n+"/"+a}var l=Math.floor(t/1e4),o=Math.floor(t%1e4/100),i=t%100;while(e>0){var s=365,c=r[o];if(2==o&&1==kr(l)&&(c=29),o<=2&&1==kr(l)&&(2==o?i<=28&&(s=366):s=366),e>=s)l+=1,e-=s;else{var p=c-i;e>p?(o+=1,i=1,13==o&&(l+=1,o=1),e-=p+1):(i+=e,e=0)}}return o<10&&(o="0"+o),i<10&&(i="0"+i),l+"/"+o+"/"+i}function br(t,e){return t=t/e*1e6,t}function Pr(t,e){return t=t/e*100,0==e?0:t}function Or(t,e){return t/=e,t}function Sr(t,e){if("year"==R)return e-t;if("month"==R){var r=Math.floor(t/100),n=t%100,a=Math.floor(e/100),l=e%100;return 12*(a-r)+(l-n)}for(var o=[0,31,28,31,30,31,30,31,31,30,31,30,31],i=Math.floor(t/1e4),s=Math.floor(t%1e4/100),c=t%100,p=Math.floor(e/1e4),u=Math.floor(e%1e4/100),_=e%100,d=0,f=i+1;f<p;f++)kr(f)?d+=366:d+=365;if(p==i)if(s==u)d+=_-c;else for(var h=s;h<=u;h++){var y=o[h];kr(i)&&2==h&&(y=29),h==s?y-=c:h==u&&(y=_),d+=y}else{for(var v=s;v<=12;v++){var m=o[v];2==v&&kr(i)&&(m=29),v==s&&(m-=c),d+=m}for(var g=1;g<=u;g++){var x=o[g];2==g&&kr(i)&&(x=29),g==u&&(x=_),d+=x}}return d}function kr(t){if(t%100==0){if(t%400==0)return 1}else if(t%4==0)return 1;return 0}String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"gm"),e)},l["json"]("population.json").then((function(t){l["json"]("square.json").then((function(e){o.country_square=e,o.country_population=t}))}))},init_values:function(){var t=this;t.width=l["select"](t.$el).node().getBoundingClientRect().width,t.height=l["select"](t.$el).node().getBoundingClientRect().height;var e=0;t.margin={top:e*t.height,bottom:e*t.height,left:e*t.width,right:e*t.width}},init:function(){var t=this;this.init_values(),p()(".map_selector").val("world"),p()(".data_selector").val("nCoV"),t.updateSelectMap("world"),t.updateSelectDataset("nCoV"),l["json"]("population.json").then((function(e){l["json"]("square.json").then((function(r){var n,a,o;t.country_square=r,t.country_population=e,l["json"]("world_map/world_new.geo.json").then((function(e){a=e,l["json"]("world_map/all_province_map.json").then((function(e){l["csv"]("https://vis.ucloud365.com/ncov/data/map.csv").then((function(r){n=r,l["csv"]("https://vis.ucloud365.com/ncov/data/foreign.csv").then((function(r){o=r;for(var i=0;i<o.length;i++){var s=0;""!=o[i]["新增确诊病例"]&&(s=parseInt(o[i]["新增确诊病例"])),""!=o[i]["核减确诊病例"]&&(s+=parseInt(o[i]["核减确诊病例"])),o[i]["新增确诊病例"]=s}for(i=0;i<n.length;i++)if("地区级"!=n[i]["类别"]&&("省级"!=n[i]["类别"]||-1!=["台湾","香港","澳门"].indexOf(n[i]["省份"]))){var c=0,p={"国家":"中国"};p["当地时间"]=n[i]["公开时间"],p["新增死亡数"]=n[i]["新增死亡数"],p["新增治愈出院数"]=n[i]["新增治愈出院数"],""!=n[i]["新增确诊病例"]&&(c=parseInt(n[i]["新增确诊病例"])),""!=n[i]["核减"]&&(c+=parseInt(n[i]["核减"])),p["新增确诊病例"]=c,o.push(p)}l["csv"]("https://vis.ucloud365.com/ncov/data/foreigndetail.csv").then((function(r){l["json"]("parameter.json").then((function(n){t.WorldMap(a,e,o,r,n)}))}))}))}))}))}))}))}))}}),created:function(){}},v=y,m=(r("d452"),r("2877")),g=Object(m["a"])(v,_,d,!1,null,null,null),x=g.exports,w=navigator.userAgent.toLowerCase(),A="Khand-Regular";/\(i[^;]+;( U;)? CPU.+Mac OS X/gi.test(w)&&(A="PingFangSC-Regular"),l["select"]("body").style("font-family",A);var b={name:"Computer",components:{mapPanel:x},data:function(){return{logoURL:r("555a")}},computed:{},watch:{},mounted:function(){this.setFontSize()},methods:Object(s["a"])({},Object(u["b"])(["updateMapData","updateStatistic","updatePathData","updateWebParameter","updateSelectMap","updateSelectDataset","updateConfirmUpdate"]),{changeBasicMap:function(t){var e=t.target.value,r=this;l["json"]("map/"+e+".geo.json").then((function(t){r.updateMapData(t),r.updateSelectMap(e)}))},changeDataSet:function(t){var e=t.target.value,r=this;r.updateSelectDataset(e)},updateAllData:function(){var t=this;t.updateConfirmUpdate(!0)},changeLineColor:function(t){var e=t.target.value,r=l["select"]("#arrow");r.select("path").attr("fill",e).attr("fill-opacity",.7),l["selectAll"](".links").style("stroke-width",(function(t){})).style("stroke",e).attr("stroke-opacity",.5).attr("marker-end","url(#arrow)")},changeCircleColor:function(t){var e=t.target.value;l["selectAll"](".num_circle").attr("fill",(function(t,r){return e})).style("fill-opacity",(function(t,e){return.3}))},uploadCSV:function(){var t=this,e=new FileReader,r=document.getElementById("file_csv").files[0];e.readAsText(r,"utf-8");var n=[];e.onload=function(e){n=e.target.result.split("\r\n");for(var r=[],a=n[0].split(","),l=1;l<n.length;l++){for(var o=n[l].split(","),i={},s=0;s<a.length;s++)void 0!=o[s]&&(i[a[s].split("\r")[0]]=o[s].split("\r")[0]);r.push(i)}t.updateStatistic(r)}},uploadPath:function(){var t=this,e=new FileReader,r=document.getElementById("file_csv").files[0];e.readAsText(r,"utf-8");var n=[];e.onload=function(e){n=e.target.result.split("\n");for(var r=[],a=n[0].split(","),l=1;l<n.length;l++){for(var o=n[l].split(","),i={},s=0;s<a.length;s++)i[a[s]]=o[s];r.push(i)}t.uploadPath(r)}},uploadParameter:function(){var t=this,e=new FileReader,r=document.getElementById("para_json").files[0];e.readAsText(r,"utf-8");var n=[];e.onload=function(e){n=e.target.result;var r={};r=JSON.parse(n),t.updateWebParameter(r)}},setFontSize:function(){var t=document,e=window,r=t.documentElement,n="orientationchange"in window?"orientationchange":"resize",a=function(){var t=r.clientWidth,e=r.clientHeight;t&&e&&(r.style.fontSize=Math.min(t,e)/65+"px")};t.addEventListener&&(e.addEventListener(n,a,!1),t.addEventListener("DOMContentLoaded",a,!1),a())}})},P=b,O=(r("7e95"),Object(m["a"])(P,o,i,!1,null,null,null)),S=O.exports,k=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app-phone"}},[r("div",{attrs:{id:"left"}},[r("div",{staticClass:"generateMap selectBox"},[t._m(0),r("div",{staticClass:"existData"},[r("span",[t._v("Select base map")]),r("br"),r("select",{staticClass:"map_selector",attrs:{name:"test"},on:{change:function(e){return t.changeBasicMap(e)}}},[r("option",{attrs:{value:"world"}},[t._v("world")]),r("option",{attrs:{value:"china"}},[t._v("china")])]),r("br"),r("span",[t._v("Select dataset")]),r("br"),r("select",{staticClass:"data_selector",attrs:{name:"test"},on:{change:function(e){return t.changeDataSet(e)}}},[r("option",{attrs:{value:"nCoV"}},[t._v("nCoV")]),r("option",{attrs:{value:"GDP"}},[t._v("GDP")])])])]),r("div",{staticClass:"changeStyle selectBox"},[t._m(1),r("div",{staticClass:"styleTypes"},[r("span",[t._v("Line")]),r("br"),r("select",{attrs:{name:"test"},on:{change:function(e){return t.changeLineColor(e)}}},[r("option",{attrs:{value:"white"}},[t._v("White")]),r("option",{attrs:{value:"rgb(110,110,110)"}},[t._v("Gray")])]),r("br"),r("span",[t._v("Circle")]),r("br"),r("select",{attrs:{name:"test"},on:{change:function(e){return t.changeCircleColor(e)}}},[r("option",{attrs:{value:"rgb(247,254,174)"}},[t._v("Yellow")]),r("option",{attrs:{value:"white"}},[t._v("White")])]),r("br"),r("span",[t._v("Color Scale")]),r("br"),r("select",{attrs:{name:"test"},on:{change:function(e){return t.changeColorRange(t.event)}}},[r("option",{attrs:{value:"0"}},[t._v("Red Group")])])])]),r("div",{staticClass:"uploadData selectBox"},[t._m(2),t._m(3),r("div",{staticClass:"uploadPanel my_upload"},[t._v(" 上传CSV文件 "),r("input",{attrs:{type:"file",id:"file_csv",accept:".csv"},on:{change:function(e){return t.uploadCSV()}}}),r("div",{attrs:{id:"result"}})]),r("div",{staticClass:"uploadPanel2 my_upload"},[t._v(" 上传path文件 "),r("input",{attrs:{type:"file",id:"file_csv",accept:".csv"},on:{change:function(e){return t.uploadfile()}}}),r("div",{attrs:{id:"result"}})]),r("div",{staticClass:"uploadPanel3 my_upload"},[t._v(" 上传web参数文件 "),r("input",{attrs:{type:"file",id:"para_json",accept:".json"},on:{change:function(e){return t.uploadParameter()}}}),r("div",{attrs:{id:"result"}})]),r("div",{attrs:{id:"confirm_update_text"}},[r("span",{on:{click:function(e){return t.updateAllData()}}},[t._v("Generate Map")])])])]),r("div",{attrs:{id:"middle"}},[r("div",{attrs:{id:"middle-left"}},[r("div",{attrs:{id:"top-text"}},[t._v("COVID-19: Global Condition")]),r("mapPanel"),r("div",{attrs:{id:"logo"}},[r("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.logoURL,alt:"image"}})])],1)]),r("div",{attrs:{id:"bottom"}})])},C=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"selectTitle"},[r("span",[t._v("Generate map")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"selectTitle"},[r("span",[t._v("Style")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"selectTitle"},[r("span",[t._v("Upload Data")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"uploadExplaination"},[r("div",{staticClass:"detailsText"},[r("span",[t._v("You can create new maps by uploading your own data.")]),r("br"),r("span",[t._v("For details and structures of the data, please check the descriptions.")]),r("br")])])}],j=navigator.userAgent.toLowerCase(),D="Khand-Regular";/\(i[^;]+;( U;)? CPU.+Mac OS X/gi.test(j)&&(D="PingFangSC-Regular"),l["select"]("body").style("font-family",D);var T={name:"Phone",components:{mapPanel:x},data:function(){return{logoURL:r("555a")}},computed:{},watch:{},mounted:function(){this.setFontSize()},methods:Object(s["a"])({},Object(u["b"])(["updateMapData","updateStatistic","updatePathData","updateWebParameter","updateSelectMap","updateSelectDataset","updateConfirmUpdate"]),{changeBasicMap:function(t){var e=t.target.value,r=this;l["json"]("map/"+e+".geo.json").then((function(t){r.updateMapData(t),r.updateSelectMap(e)}))},changeDataSet:function(t){var e=t.target.value,r=this;r.updateSelectDataset(e)},updateAllData:function(){var t=this;t.updateConfirmUpdate(!0)},changeLineColor:function(t){var e=t.target.value,r=l["select"]("#arrow");r.select("path").attr("fill",e).attr("fill-opacity",.7),l["selectAll"](".links").style("stroke-width",(function(t){})).style("stroke",e).attr("stroke-opacity",.5).attr("marker-end","url(#arrow)")},changeCircleColor:function(t){var e=t.target.value;l["selectAll"](".num_circle").attr("fill",(function(t,r){return e})).style("fill-opacity",(function(t,e){return.3}))},uploadCSV:function(){var t=this,e=new FileReader,r=document.getElementById("file_csv").files[0];e.readAsText(r,"utf-8");var n=[];e.onload=function(e){n=e.target.result.split("\r\n");for(var r=[],a=n[0].split(","),l=1;l<n.length;l++){for(var o=n[l].split(","),i={},s=0;s<a.length;s++)void 0!=o[s]&&(i[a[s].split("\r")[0]]=o[s].split("\r")[0]);r.push(i)}t.updateStatistic(r)}},uploadPath:function(){var t=this,e=new FileReader,r=document.getElementById("file_csv").files[0];e.readAsText(r,"utf-8");var n=[];e.onload=function(e){n=e.target.result.split("\n");for(var r=[],a=n[0].split(","),l=1;l<n.length;l++){for(var o=n[l].split(","),i={},s=0;s<a.length;s++)i[a[s]]=o[s];r.push(i)}t.uploadPath(r)}},uploadParameter:function(){var t=this,e=new FileReader,r=document.getElementById("para_json").files[0];e.readAsText(r,"utf-8");var n=[];e.onload=function(e){n=e.target.result;var r={};r=JSON.parse(n),t.updateWebParameter(r)}},setFontSize:function(){var t=document,e=window,r=t.documentElement,n="orientationchange"in window?"orientationchange":"resize",a=function(){var t=r.clientWidth,e=r.clientHeight;t&&e&&(r.style.fontSize=Math.min(t,e)/65+"px")};t.addEventListener&&(e.addEventListener(n,a,!1),t.addEventListener("DOMContentLoaded",a,!1),a())}})},M=T,z=(r("0bb3"),Object(m["a"])(M,k,C,!1,null,null,null)),I=z.exports,E={name:"App",components:{Computer:S,Phone:I},data:function(){return{currentView:null}},mounted:function(){window.onresize=function(){console.log("???")};var t=this,e=l["select"](t.$el).node().getBoundingClientRect().width,r=l["select"](t.$el).node().getBoundingClientRect().height;this.currentView=r>e?"Phone":"Computer"}},L=E,U=(r("034f"),Object(m["a"])(L,n,a,!1,null,null,null));e["default"]=U.exports},"555a":function(t,e,r){t.exports=r.p+"img/icon.f2a72eeb.png"},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=r("3dfd"),l=(r("d3b7"),r("8c4f"));n["a"].use(l["a"]);var o=[{path:"/",name:"App",meta:{title:"Map Visualization toolkit"},component:function(){return Promise.resolve().then(r.bind(null,"3dfd"))}}],i=new l["a"]({routes:o});i.beforeEach((function(t,e,r){document.title=t.meta.title||"NCP VIS",r()}));var s,c=i,p=r("ade3"),u=r("2f62");n["a"].use(u["a"]);var _={UPDATE_SELECT_MAP:"UPDATE_SELECT_MAP",UPDATE_SELECT_DATASET:"UPDATE_SELECT_DATASET",UPDATE_MAP_DATA:"UPDATE_MAP_DATA",UPDATE_STATISTIC:"UPDATE_STATISTIC",UPDATE_PATH_DATA:"UPDATE_PATH_DATA",UPDATE_WEB_PARAMETER:"UPDATE_WEB_PARAMETER",UPDATE_COMFIRM_UPDATE:"UPDATE_COMFIRM_UPDATE"},d=new u["a"].Store({state:{selectedMap:"world",selectedDataSet:"nCoV",mapData:{},statistic:null,pathData:{},webParameter:null,confirmUpdate:null},getters:{selectedMap:function(t){return t.selectedMap},selectedDataSet:function(t){return t.selectedDataSet},mapData:function(t){return t.mapData},statistic:function(t){return t.statistic},pathData:function(t){return t.pathData},webParameter:function(t){return t.webParameter},confirmUpdate:function(t){return t.confirmUpdate}},mutations:(s={},Object(p["a"])(s,_.UPDATE_SELECT_MAP,(function(t,e){t.selectedMap=e})),Object(p["a"])(s,_.UPDATE_SELECT_DATASET,(function(t,e){t.selectedDataSet=e})),Object(p["a"])(s,_.UPDATE_MAP_DATA,(function(t,e){t.mapData=e})),Object(p["a"])(s,_.UPDATE_STATISTIC,(function(t,e){t.statistic=e})),Object(p["a"])(s,_.UPDATE_PATH_DATA,(function(t,e){t.pathData=e})),Object(p["a"])(s,_.UPDATE_WEB_PARAMETER,(function(t,e){t.webParameter=e})),Object(p["a"])(s,_.UPDATE_COMFIRM_UPDATE,(function(t,e){t.confirmUpdate=e})),s),actions:{updateSelectMap:function(t,e){var r=t.commit;r(_.UPDATE_SELECT_MAP,e)},updateSelectDataset:function(t,e){var r=t.commit;r(_.UPDATE_SELECT_DATASET,e)},updateMapData:function(t,e){var r=t.commit;r(_.UPDATE_MAP_DATA,e)},updateStatistic:function(t,e){var r=t.commit;r(_.UPDATE_STATISTIC,e)},updatePathData:function(t,e){var r=t.commit;r(_.UPDATE_PATH_DATA,e)},updateWebParameter:function(t,e){var r=t.commit;r(_.UPDATE_WEB_PARAMETER,e)},updateConfirmUpdate:function(t,e){var r=t.commit;r(_.UPDATE_COMFIRM_UPDATE,e)}},modules:{}}),f=r("1157"),h=r.n(f),y=r("5698");window.$=h.a,window.jQuery=h.a,window.d3=y,n["a"].config.productionTip=!1,new n["a"]({router:c,store:d,render:function(t){return t(a["default"])}}).$mount("#app")},7731:function(t,e,r){},"7e95":function(t,e,r){"use strict";var n=r("7731"),a=r.n(n);a.a},"85ec":function(t,e,r){},"99d9":function(t,e,r){},c779:function(t,e,r){},d452:function(t,e,r){"use strict";var n=r("c779"),a=r.n(n);a.a}});